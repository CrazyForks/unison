<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="hevea 2.35">
<style type="text/css">
.equationcontainer{position:relative;}
.equationnumber{float:right;left:auto;position:absolute;right:0}
.equationnumber-valign{float:right;left:auto;position:absolute;right:0;margin-top:-0.5em;}
.floatrule{background-color: black; border: none; height: 1px; width: 80%}
.phantom{display: inline-block; visibility: hidden}
.hphantom{display: inline-block; height: 0; visibility: hidden}
.vphantom{display: inline-block; visibility: hidden; width: 0}
.smash{display: inline-block; height: 0; line-height: 0}
.li-itemize{margin:1ex 0ex;}
.li-enumerate{margin:1ex 0ex;}
.dd-description{margin:0ex 0ex 1ex 4ex;}
.dt-description{margin:0ex;}
.toc{list-style:none;}
.footnotetext{margin:0ex; padding:0ex;}
div.footnotetext P{margin:0px; text-indent:1em;}
.thefootnotes{text-align:left;margin:0ex;}
.dt-thefootnotes{margin:0em;}
.dd-thefootnotes{margin:0em 0em 0em 2em;}
.footnoterule{background-color: black; border: none; height: 1px; margin: 1em auto 1em 0px; width: 40%}
.caption{padding-left:2ex; padding-right:2ex; margin-left:auto; margin-right:auto}
.title{margin:2ex auto;text-align:center}
.titlemain{margin:1ex 2ex 2ex 1ex;}
.titlerest{margin:0ex 2ex;}
.center{text-align:center;margin-left:auto;margin-right:auto;}
.flushleft{text-align:left;margin-left:0ex;margin-right:auto;}
.flushright{text-align:right;margin-left:auto;margin-right:0ex;}
div table{margin-left:inherit;margin-right:inherit;margin-bottom:2px;margin-top:2px}
td table{margin:auto;}
table{border-collapse:collapse;}
td{padding:0;}
.cellpadding0 tr td{padding:0;}
.cellpadding1 tr td{padding:1px;}
pre{text-align:left;margin-left:0ex;margin-right:auto;}
blockquote{margin-left:4ex;margin-right:4ex;text-align:left;}
td p{margin:0px;}
.quote{margin-left:3em;margin-right:3em;text-align:inherit;text-indent:0pt}
.quotation{margin-left:3em;margin-right:3em;text-align:inherit;text-indent:1.5em}
.verse{margin-left:3em;margin-right:3em;text-indent:1.5em hanging each-line}
.parbox{box-sizing: border-box;
display: inline-block;
text-indent: 0;
}
.rule-rect{fill: black;}
.lrbox{box-sizing:border-box;display:inline-block;overflow:visible;white-space:nowrap;}
.center-lrbox{display:inline-block;margin-left:50%;transform:translateX(-50%);}
.makebox{}
.framebox{border:1px solid black;padding:0.25em;}
.vertical-rule{border:none;width:2px;background-color:black;}
.horizontal-rule{border:none;background-color:black;}
.hrule{border:none;height:2px;width:100%;background-color:black;}
.hfill{border:none;height:1px;width:200%;background-color:black;}
.vdisplay{border-collapse:separate;border-spacing:2px;line-height:1.1;width:auto; empty-cells:show; border:2px solid red;}
.vdcell{white-space:nowrap;padding:0px; border:2px solid green;}
.display{border-collapse:separate;border-spacing:2px;line-height:1.1;width:auto; border:none;}
.dcell{white-space:nowrap;padding:0px; border:none;}
.dcenter{margin:0ex auto;}
.vdcenter{border:solid #FF8000 2px; margin:0ex auto;}
.minipage{text-align:left; margin-left:0em; margin-right:auto;}
.marginpar{border:solid thin black; margin-bottom:1ex; width:20%; text-align:left;}
.marginparleft{float:left; clear:left; margin-left:0ex; margin-right:1ex;}
.marginparright{float:right; clear:right; margin-left:1ex; margin-right:0ex;}
.theorem{text-align:left;margin:1ex auto 1ex 0ex;}
.part{margin:2ex auto;text-align:center}
</style>

 <META name="Author" content="Benjamin C. Pierce">
 <link rel="stylesheet" href="http://www.cis.upenn.edu/~bcpierce/unison/unison.css">
 
<title>unison-manual</title>
</head>
<body >
<!--HEVEA command line is: hevea unison-manual.tex -->
<!--CUT STYLE article--><!--CUT DEF section 1 --><p><div id="manualbody"></p><p><div id="manualheader"></p><div class="center"><span style="font-size:xx-large"><span style="font-size:150%"><span style="color:black">Unison File Synchronizer</span></span></span><span style="font-size:xx-large"><span style="font-size:150%"><br>
</span></span><span style="font-size:150%"><span style="font-size:xx-large"><span style="color:black">User Manual and Reference Guide</span></span></span><span style="font-size:150%"><span style="font-size:xx-large"><br>
<span style="font-size:x-large">Version 2.53.3<br>
<span style="font-size:large">Copyright 1998-2020, Benjamin C. Pierce
</span></span></span></span></div><p></div></p><!--TOC section id="sec1" Contents-->
<h2 id="sec1" class="section">Contents</h2><!--SEC END --><blockquote class="quote">
<a href="#overview"><span style="font-size:large"><span style="font-weight:bold">Overview</span></span></a><br>
<a href="#intro"><span style="font-size:large"><span style="font-weight:bold">Preface</span></span></a><br>
          •<a href="#people">People</a><br>
          •<a href="#obtaining">Obtaining Unison</a><br>
          •<a href="#development">Community, Maintenance, and Development</a><br>
          •<a href="#copying">Copying</a><br>
          •<a href="#ack">Acknowledgements</a><br>
<a href="#upgrading"><span style="font-size:large"><span style="font-weight:bold">Upgrading</span></span></a><br>
          •<a href="#interoperability">Version interoperability</a><br>
<a href="#tutorial"><span style="font-size:large"><span style="font-weight:bold">Tutorial</span></span></a><br>
          •<a href="#prelim">Preliminaries</a><br>
          •<a href="#local">Local Usage</a><br>
          •<a href="#remote">Remote Usage</a><br>
          •<a href="#rshmeth">Remote Shell Method</a><br>
          •<a href="#socketmeth">Socket Method</a><br>
                  <a href="#socket-tcp">TCP Sockets</a><br>
                  <a href="#socket-unix">Unix Domain Sockets</a><br>
          •<a href="#usingit">Using Unison for All Your Files</a><br>
          •<a href="#usingmultiple">Using Unison to Synchronize More Than Two Machines</a><br>
          •<a href="#further">Going Further</a><br>
<a href="#basics"><span style="font-size:large"><span style="font-weight:bold">Basic Concepts</span></span></a><br>
          •<a href="#roots">Roots</a><br>
          •<a href="#paths">Paths</a><br>
          •<a href="#updates">What is an Update?</a><br>
          •<a href="#conflicts">What is a Conflict?</a><br>
          •<a href="#recon">Reconciliation</a><br>
          •<a href="#failures">Invariants</a><br>
          •<a href="#caveats">Caveats and Shortcomings</a><br>
<a href="#reference"><span style="font-size:large"><span style="font-weight:bold">Reference Guide</span></span></a><br>
          •<a href="#running">Running Unison</a><br>
          •<a href="#unisondir">The <span style="font-family:monospace">.unison</span> Directory</a><br>
          •<a href="#archives">Archive Files</a><br>
          •<a href="#prefs">Preferences</a><br>
          •<a href="#profile">Profiles</a><br>
          •<a href="#profileegs">Sample Profiles</a><br>
                  <a href="#minimalprofile">A Minimal Profile</a><br>
                  <a href="#basicprofile">A Basic Profile</a><br>
                  <a href="#powerprofile">A Power-User Profile</a><br>
          •<a href="#backups">Keeping Backups</a><br>
          •<a href="#merge">Merging Conflicting Versions</a><br>
          •<a href="#ui">The User Interface</a><br>
          •<a href="#intr">Interrupting a Synchronization</a><br>
          •<a href="#exit">Exit Code</a><br>
          •<a href="#pathspec">Path Specification</a><br>
          •<a href="#ignore">Ignoring Paths</a><br>
          •<a href="#symlinks">Symbolic Links</a><br>
          •<a href="#perms">Permissions</a><br>
          •<a href="#acls">Access Control Lists - ACLs</a><br>
          •<a href="#xattrs">Extended Attributes - xattrs</a><br>
          •<a href="#crossplatform">Cross-Platform Synchronization</a><br>
          •<a href="#speed">Slow Links</a><br>
          •<a href="#speeding">Making Unison Faster on Large Files</a><br>
          •<a href="#fastcheck">Fast Update Detection</a><br>
          •<a href="#mountpoints">Mount Points and Removable Media</a><br>

</blockquote><p><hr></p><!--TOC section id="sec2" Overview-->
<h2 id="sec2" class="section"><a id="overview">Overview</a></h2><!--SEC END --><p>Unison is a file-synchronization tool for Unix and Windows. It allows
two replicas of a collection of files and directories to be stored on
different hosts (or different disks on the same host), modified
separately, and then brought up to date by propagating the changes in
each replica to the other.</p><p>Unison
shares a number of features with tools such as configuration
management packages (<a href="http://www.cyclic.com/">CVS</a>,
<a href="http://www.XCF.Berkeley.EDU/~jmacd/prcs.html">PRCS</a>,
etc.),
distributed filesystems
(<a href="http://www.coda.cs.cmu.edu/">Coda</a>,
etc.),
uni-directional mirroring utilities
(<a href="http://samba.anu.edu.au/rsync/">rsync</a>,
etc.),
and other synchronizers
(<a href="http://www.pumatech.com">Intellisync</a>,
<a href="http://www.merl.com/reports/TR99-14/">Reconcile</a>,
etc). 
However, there are several points where it differs:
</p><ul class="itemize"><li class="li-itemize">
Unison runs on both Windows (95, 98, NT, 2k, and XP) and Unix (OSX, Solaris,
Linux, etc.) systems. Moreover, Unison works <em>across</em>
platforms, allowing you to synchronize a Windows laptop with a
Unix server, for example.
</li><li class="li-itemize">Unlike a distributed filesystem, Unison is a user-level program:
there is no need to modify the kernel or to have
superuser privileges on either host.
</li><li class="li-itemize">Unlike simple mirroring or backup utilities, Unison can deal
with updates to both replicas of a distributed directory structure.
Updates that do not conflict are propagated automatically.
Conflicting updates are detected and displayed.
</li><li class="li-itemize">Unison works between any pair of machines connected to the
internet, communicating over either a direct socket link or
tunneling over an encrypted <span style="font-family:monospace">ssh</span> connection.
It is careful with network bandwidth, and runs well over slow links
such as PPP connections. Transfers of small updates to large files are
optimized using a compression protocol similar to rsync.
</li><li class="li-itemize">Unison has a clear and precise specification, described
below. </li><li class="li-itemize">Unison is resilient to failure. It is careful to leave the
replicas and its own private structures in a sensible state at all
times, even in case of abnormal termination or communication
failures.
</li><li class="li-itemize">Unison is free; full source code is available under the GNU
Public License.
</li></ul><p><hr></p><!--TOC section id="sec3" Preface-->
<h2 id="sec3" class="section"><a id="intro">Preface</a></h2><!--SEC END --><!--TOC subsection id="sec4" People-->
<h3 id="sec4" class="subsection"><a id="people">People</a></h3><!--SEC END --><p><a href="http://www.cis.upenn.edu/~bcpierce/">Benjamin Pierce</a> leads the
Unison project.
The current version of Unison was designed and implemented by
<a href="http://www.research.att.com/~trevor/">Trevor Jim</a>,
<a href="http://www.cis.upenn.edu/~bcpierce/">Benjamin Pierce</a>,
and
<a href="http://www.pps.jussieu.fr/~vouillon/">Jérôme Vouillon</a>,
with
<a href="http://alan.petitepomme.net/">Alan Schmitt</a>,
Malo Denielou,
<a href="http://www.brics.dk/~zheyang/">Zhe Yang</a>,
Sylvain Gommier, and
Matthieu Goulay.
The Mac user interface was started by Trevor Jim and enormously improved by
Ben Willmore.
Our implementation of the
<a href="http://samba.org/rsync/">rsync</a>
protocol was built by
<a href="http://www.eecs.harvard.edu/~nr/">Norman Ramsey</a>
and Sylvain Gommier. It is based on
<a href="http://samba.anu.edu.au/~tridge/">Andrew Tridgell</a>’s
<a href="http://samba.anu.edu.au/~tridge/phd_thesis.pdf">thesis work</a>
and inspired by his
<a href="http://samba.org/rsync/">rsync</a>
utility.
The mirroring and merging functionality was implemented by
Sylvain Roy, improved by Malo Denielou, and improved yet further by
Stéphane Lescuyer.
<a href="http://wwwfun.kurims.kyoto-u.ac.jp/~garrigue/">Jacques Garrigue</a>
contributed the original Gtk version of the user
interface; the Gtk2 version was built by Stephen Tse.
Sundar Balasubramaniam helped build a prototype implementation of
an earlier synchronizer in Java.
<a href="http://www.cis.upenn.edu/~ishin/">Insik Shin</a>
and
<a href="http://www.cis.upenn.edu/~lee/">Insup Lee</a> contributed design
ideas to this implementation.
<a href="http://research.microsoft.com/~fournet/">Cedric Fournet</a>
contributed to an even earlier prototype.</p><!--TOC subsection id="sec5" Obtaining Unison-->
<h3 id="sec5" class="subsection"><a id="obtaining">Obtaining Unison</a></h3><!--SEC END -->
<!--TOC paragraph id="sec6" Source code-->
<h4 id="sec6" class="paragraph">Source code</h4><!--SEC END --><p>Unison is primarily distributed as source code, which contains
instructions in <span style="font-family:monospace">INSTALL.md</span>:
</p><blockquote class="quote">
<a href="https://github.com/bcpierce00/unison"><span style="font-family:monospace">https://github.com/bcpierce00/unison</span></a>
</blockquote>
<!--TOC paragraph id="sec7" Binaries-->
<h4 id="sec7" class="paragraph">Binaries</h4><!--SEC END --><p>The Unison wiki contains information about builds done as part of
Continuous Integration and other sources of binaries; read the entire
wiki at:
</p><blockquote class="quote">
<a href="https://github.com/bcpierce00/unison/wiki"><span style="font-family:monospace">https://github.com/bcpierce00/unison/wiki</span></a>
</blockquote><!--TOC subsection id="sec8" Community, Maintenance, and Development-->
<h3 id="sec8" class="subsection"><a id="development">Community, Maintenance, and Development</a></h3><!--SEC END --><p>Many people use and contribute to Unison.
This community has two main homes.</p>
<!--TOC paragraph id="sec9" Mailinglists-->
<h4 id="sec9" class="paragraph">Mailinglists</h4><!--SEC END --><p>Most discussion is appropriate on one of the mailinglists:
</p><blockquote class="quote">
<a href="https://github.com/bcpierce00/unison/wiki/Mailing-Lists"><span style="font-family:monospace">https://github.com/bcpierce00/unison/wiki/Mailing-Lists</span></a>
</blockquote>
<!--TOC paragraph id="sec10" Reporting Bugs-->
<h4 id="sec10" class="paragraph">Reporting Bugs</h4><!--SEC END --><p>Bug reports and feature requests may be made after reading the guidelines:
</p><blockquote class="quote">
<a href="https://github.com/bcpierce00/unison/wiki/Reporting-Bugs-and-Feature-Requests"><span style="font-family:monospace">https://github.com/bcpierce00/unison/wiki/Reporting-Bugs-and-Feature-Requests</span></a>
</blockquote><p>Help improving Unison is welcome; see <span style="font-family:monospace">CONTRIBUTING.md</span> in the sources.</p><!--TOC subsection id="sec11" Copying-->
<h3 id="sec11" class="subsection"><a id="copying">Copying</a></h3><!--SEC END --><p>This file is part of Unison.</p><p>Unison is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.</p><p>Unison is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.</p><p>The GNU General Public License can be found at
<a href="http://www.gnu.org/licenses"><span style="font-family:monospace">http://www.gnu.org/licenses</span></a>. A copy is also included in the
Unison source distribution in the file <span style="font-family:monospace">COPYING</span>.</p><!--TOC subsection id="sec12" Acknowledgements-->
<h3 id="sec12" class="subsection"><a id="ack">Acknowledgements</a></h3><!--SEC END --><p>Work on Unison has been supported by the National Science Foundation
under grants CCR-9701826 and ITR-0113226, <em>Principles and Practice of
Synchronization</em>, and by University of Pennsylvania’s Institute for
Research in Cognitive Science (IRCS).</p><p><hr></p><!--TOC section id="sec13" Upgrading-->
<h2 id="sec13" class="section"><a id="upgrading">Upgrading</a></h2><!--SEC END --><p>(This section is perhaps misplaced, but is early because it is far
better to have at least skimmed it than to not know it exists.)</p><p>Before upgrading, it is a good idea to run the <em>old</em> version one last
time, to make sure all your replicas are completely synchronized. A new
version of Unison will sometimes introduce a different format for the
archive files used to remember information about the previous state of the
replicas. In this case, the old archive will be ignored (not deleted — if
you roll back to the previous version of Unison, you will find the old
archives intact), which means that any differences between the replicas will
show up as conflicts that need to be resolved manually.</p><p>As of version 2.52, Unison has a degree of backward and forward
compatibility. This means three things. First, it is possible for local
and remote machines to run a different version of Unison. Second, it is
possible for local and remote machines to run a version (same or different)
of Unison built with a different version of OCaml compiler (this has been
problematic historically). Lastly, it is possible to upgrade Unison on
the local machine (compiled with any OCaml version) and keep the existing
archive.</p><p>If version interoperability requirements are followed then Unison 2.52 and
newer can upgrade the archive created by earlier Unison versions. To avoid
rebuilding archive files when upgrading from a version older than 2.52, you
must install version 2.52 or newer built with the same OCaml version as your
previous version of Unison, and then run it at least once on each root. Doing
so will upgrade the archive file.</p><p>After upgrading the archive, you are free to swap the Unison 2.52 or newer
executable to one compiled with a different version of OCaml.
The archive file is no longer dependent on the compiler version.</p><!--TOC subsection id="sec14" Version interoperability-->
<h3 id="sec14" class="subsection"><a id="interoperability">Version interoperability</a></h3><!--SEC END --><p>To ensure interoperability with different Unison versions on local and
remote machines, and to upgrade from an earlier version <em>without
rebuilding the archive files</em>, you have to remember these guidelines.
Upgrading from an incompatible version, while possible and normal, will
require fully scanning both roots, which can be time-consuming with big
replicas.</p><p><span style="font-weight:bold">Unison 2.52 and newer</span> are compatible with:
</p><ul class="itemize"><li class="li-itemize">
<em>Unison 2.52 or newer</em> (for as long as backwards compatibility
is maintained in the newer versions). You do not have to pay any attention
to OCaml compiler versions.
</li><li class="li-itemize"><em>Unison 2.51</em> if both versions are compiled with same OCaml
compiler version (you can see which compiler version was used by running
<span style="font-family:monospace">unison -version</span>).
</li><li class="li-itemize"><em>Unison 2.48</em> if both versions are compiled with same OCaml
compiler version. See special notes below.
</li></ul><p><br>

<span style="font-weight:bold">Interoperability matrix</span> for quick reference:</p><p><br>

</p><table border=1  style="border-spacing:0;" class="cellpadding1"><tr><td style="text-align:right;border:solid 1px;white-space:nowrap" > Client versions</td><td style="text-align:center;border:solid 1px;white-space:nowrap"  colspan=3>Server versions </td></tr>
<tr><td style="text-align:right;border:solid 1px;white-space:nowrap" >&nbsp;</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >2.52 or newer</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >2.51</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >2.48 </td></tr>
<tr><td style="text-align:right;border:solid 1px;white-space:nowrap" > 2.52 or newer</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >full interop</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >same OCaml version</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >same OCaml version </td></tr>
<tr><td style="text-align:right;border:solid 1px;white-space:nowrap" > 2.51</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >same OCaml version</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >full interop</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >no interop </td></tr>
<tr><td style="text-align:right;border:solid 1px;white-space:nowrap" > 2.48</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >same OCaml version*</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >no interop</td><td style="text-align:center;border:solid 1px;white-space:nowrap" >full interop </td></tr>
</table><p>
<br>
<br>
</p><p><span style="font-style:italic">Special notes for Unison 2.48:</span>
</p><ul class="itemize"><li class="li-itemize">
Unison 2.48 does not show which OCaml compiler was used to compile it.
If you do not have the option of re-compiling the 2.48 version, you have
two alternatives. First (and most likely to succeed), see what is the version
of the OCaml compiler in the same package repository where you installed
Unison 2.48 from, then use Unison 2.52 compiled with that version.
Second, you can just try Unison 2.52 executables compiled with different
OCaml versions and see which one works with your copy of Unison 2.48.
</li><li class="li-itemize">When running Unison 2.48 on the client machine with Unison 2.52 or
newer on the server machine, you have to do some additional configuration.
The Unison executable name on the server must start with <code class="verb">unison-2.48</code>
(just <code class="verb">unison-2.48</code> is ok, as is <code class="verb">unison-2.48.exe</code>, but also
<code class="verb">unison-2.48+ocaml-4.05</code>). If using TCP socket connection to the
server then you’re all set! If using <span style="font-family:monospace">ssh</span> then you have to add one
of the following options to your profile or as a command-line argument
on the client machine: <code class="verb">-addversionno</code>; see
the <a href="#remote">Remote Usage</a> section, or <code class="verb">-servercmd</code>; see
the <a href="#rshmeth">Remote Shell Method</a> section.
</li></ul><p><hr></p><!--TOC section id="sec15" Tutorial-->
<h2 id="sec15" class="section"><a id="tutorial">Tutorial</a></h2><!--SEC END --><!--TOC subsection id="sec16" Preliminaries-->
<h3 id="sec16" class="subsection"><a id="prelim">Preliminaries</a></h3><!--SEC END --><p>Unison can be used with either of two user interfaces:
</p><ol class="enumerate" type=1><li class="li-enumerate">
a textual interface and
</li><li class="li-enumerate">a graphical interface
</li></ol><p>
The textual interface is more convenient for running from scripts and
works on dumb terminals; the graphical interface is better for most
interactive use. For this tutorial, you can use either. If you are running
Unison from the command line, just typing <span style="font-family:monospace">unison</span>
will select either the text or the graphical interface, depending on which
has been selected as default when the executable you are running was
built. You can force the text interface even if graphical is the default by
adding <span style="font-family:monospace">-ui text</span>.
The other command-line arguments to both versions are identical.</p><p>The graphical version can also be run directly by clicking on its
icon.
For this tutorial, we assume that you’re starting it from the command
line.</p><p>Unison can synchronize files and directories on a single machine, or
between two machines on a network. (The same program runs on both
machines; the only difference is which one is responsible for
displaying the user interface.) If you’re only interested in a
single-machine setup, then let’s call that machine the <em>client</em>. If
you’re synchronizing two machines, let’s call them <em>client</em> and
<em>server</em>.</p><!--TOC subsection id="sec17" Local Usage-->
<h3 id="sec17" class="subsection"><a id="local">Local Usage</a></h3><!--SEC END --><p>Let’s get the client machine set up first and see how to synchronize
two directories on a single machine.</p><p>Ensure that unison is installed on your system.</p><p>Create a small test directory <span style="font-family:monospace">a.tmp</span> containing a couple of files
and/or subdirectories, e.g.,
</p><pre class="verbatim">       mkdir a.tmp
       touch a.tmp/a a.tmp/b
       mkdir a.tmp/d
       touch a.tmp/d/f
</pre><p>
Copy this directory to b.tmp:
</p><pre class="verbatim">       cp -r a.tmp b.tmp
</pre><p>Now try synchronizing <span style="font-family:monospace">a.tmp</span> and <span style="font-family:monospace">b.tmp</span>. (Since they are
identical, synchronizing them won’t propagate any changes, but Unison
will remember the current state of both directories so that it will be
able to tell next time what has changed.) Type:
</p><pre class="verbatim">       unison a.tmp b.tmp
</pre><p>
(You may need to add <code class="verb">-ui text</code>, depending how your unison binary was built.)</p><p><br>
<em>Textual Interface:</em></p><ul class="itemize"><li class="li-itemize">

You should see a message notifying you that all the files are actually
equal and then get returned to the command line.
</li></ul><p><br>
<em>Graphical Interface:</em></p><ul class="itemize"><li class="li-itemize">

You should get a big empty window with a message at the bottom
notifying you that all files are identical. Choose the Exit item from
the File menu to get back to the command line.
</li></ul><p>Next, make some changes in a.tmp and/or b.tmp. For example:
</p><pre class="verbatim">        rm a.tmp/a
        echo "Hello" &gt; a.tmp/b
        echo "Hello" &gt; b.tmp/b
        date &gt; b.tmp/c
        echo "Hi there" &gt; a.tmp/d/h
        echo "Hello there" &gt; b.tmp/d/h
</pre><p>
Run Unison again:
</p><pre class="verbatim">       unison a.tmp b.tmp
</pre><p>This time, the user interface will display only the files that have
changed. If a file has been modified in just one
replica, then it will be displayed with an arrow indicating the
direction that the change needs to be propagated. For example,
</p><pre class="verbatim">                 &lt;---  new file   c  [f]
</pre><p>
indicates that the file <span style="font-family:monospace">c</span> has been modified only in the second
replica, and that the default action is therefore to propagate the new
version to the first replica. To <span style="font-weight:bold">f</span>ollow Unison’s recommendation,
press the “f” at the prompt.</p><p>If both replicas are modified and their contents are different, then
the changes are in conflict: <span style="font-family:monospace">&lt;-?-&gt;</span> is displayed to indicate
that Unison needs guidance on which replica should override the
other.
</p><pre class="verbatim">     new file  &lt;-?-&gt;  new file   d/h  []
</pre><p>
By default, neither version will be propagated and both
replicas will remain as they are.</p><p>If both replicas have been modified but their new contents are the same
(as with the file <span style="font-family:monospace">b</span>), then no propagation is necessary and
nothing is shown. Unison simply notes that the file is up to date.</p><p>These display conventions are used by both versions of the user
interface. The only difference lies in the way in which Unison’s
default actions are either accepted or overridden by the user.</p><p><br>
<em>Textual Interface:</em></p><ul class="itemize"><li class="li-itemize">

The status of each modified file is displayed, in turn.
When the copies of a file in the two replicas are not identical, the
user interface will ask for instructions as to how to propagate the
change. If some default action is indicated (by an arrow), you can
simply press Return to go on to the next changed file. If you want to
do something different with this file, press “<code class="verb">&lt;</code>” or “<code class="verb">&gt;</code>” to force
the change to be propagated from right to left or from left to right,
or else press “<code class="verb">/</code>” to skip this file and leave both replicas alone.
When it reaches the end of the list of modified files, Unison will ask
you one more time whether it should proceed with the updates that have
been selected.<p>When Unison stops to wait for input from the user, pressing “<code class="verb">?</code>”
will always give a list of possible responses and their meanings.
</p></li></ul><p><br>
<em>Graphical Interface:</em></p><ul class="itemize"><li class="li-itemize">

The main window shows all the files that have been modified in either
<span style="font-family:monospace">a.tmp</span> or <span style="font-family:monospace">b.tmp</span>. To override a default action (or to select
an action in the case when there is no default), first select the file, either
by clicking on its name or by using the up- and down-arrow keys. Then
press either the left-arrow or “<code class="verb">&lt;</code>” key (to cause the version in b.tmp to
propagate to a.tmp) or the right-arrow or “<code class="verb">&gt;</code>” key (which makes the a.tmp
version override b.tmp).<p>Every keyboard command can also be invoked from the menus at the top
of the user interface. (Conversely, each menu item is annotated with
its keyboard equivalent, if it has one.)</p><p>When you are satisfied with the directions for the propagation of changes
as shown in the main window, click the “Go” button to set them in
motion. A check sign will be displayed next to each filename
when the file has been dealt with.
</p></li></ul><!--TOC subsection id="sec18" Remote Usage-->
<h3 id="sec18" class="subsection"><a id="remote">Remote Usage</a></h3><!--SEC END --><p>Next, we’ll get Unison set up to synchronize replicas on two different
machines.</p><p>NB: Unison has not been designed to run with elevated privileges
(e.g. setuid), and it has not been audited for that environment.
Therefore Unison should be run with the userid of the owner of the
files to be synchronized, and should never be run setuid or similar.
(Problems encountered when running setuid etc. must be reproduced
without setuid before being reported as bugs.)</p><p>Follow the instructions in the Installation section to download or
build an executable version of Unison on the server machine, and
install it somewhere on your search path. (It doesn’t matter whether
you install the textual or graphical version, since the copy of Unison on
the server doesn’t need to display any user interface at all.)</p><p>It is important that the version of Unison installed on the server
machine is the same as the version of Unison on the client machine.
But some flexibility on the version of Unison at the client side can
be achieved by using the <code class="verb">-addversionno</code> option; see
the <a href="#prefs">Preferences</a> section.</p><p>Now there is a decision to be made. Unison provides two methods for
communicating between the client and the server:
</p><ul class="itemize"><li class="li-itemize">
<em>Remote shell method</em>: To use this method, you must have
some way of invoking remote commands on the server from the client’s
command line, using a facility such as <code class="verb">ssh</code>.
This method is more convenient (since there is no need to manually
start a “unison server” process on the server) and also more
secure, assuming you are using <code class="verb">ssh</code>).</li><li class="li-itemize"><em>TCP socket method</em>: This method requires only that you can
get TCP packets from the client to the server and back. It is
insecure and should not be used.</li><li class="li-itemize"><em>Unix socket method</em>: This method only works within a
single machine. It is similar to the TCP sockets method, but it is
possible to configure it securely.
</li></ul><p>Decide which of these you want to try, and continue with
the <a href="#rshmeth">Remote Shell Method</a> section or
the <a href="#socketmeth">Socket Method</a> section, as appropriate.</p><!--TOC subsection id="sec19" Remote Shell Method-->
<h3 id="sec19" class="subsection"><a id="rshmeth">Remote Shell Method</a></h3><!--SEC END --><p>The standard remote shell facility on Unix systems is <code class="verb">ssh</code>.</p><p>Running
<code class="verb">ssh</code> requires some coordination between the client and server
machines to establish that the client is allowed to invoke commands on
the server; please refer to the <code class="verb">ssh</code> documentation
for information on how to set this up.</p><p>First, test that we can invoke Unison on the server from the client.
Typing
</p><pre>
        ssh <span style="font-style:italic">remotehostname</span> unison -version
</pre><p>
should print the same version information as running
</p><pre class="verbatim">        unison -version
</pre><p>
locally on the client. If remote execution fails, then either
something is wrong with your ssh setup (e.g., “permission denied”)
or else the search path that’s being used when executing commands on
the server doesn’t contain the <code class="verb">unison</code> executable (e.g.,
“command not found”).</p><p>Create a test directory <span style="font-family:monospace">a.tmp</span> in your home directory on the client
machine.</p><p>Test that the local unison client can start and connect to the
remote server. Type
</p><pre>
          unison -testServer a.tmp ssh://<span style="font-style:italic">remotehostname</span>/a.tmp
</pre><p>Now cd to your home directory and type:
</p><pre class="verbatim">          unison a.tmp ssh://remotehostname/a.tmp
</pre><p>
The result should be that the entire directory <span style="font-family:monospace">a.tmp</span> is propagated
from the client to your home directory on the server.</p><p>After finishing the first synchronization, change a few files and try
synchronizing again. You should see similar results as in the local
case.</p><p>If your user name on the server is not the same as on the client, you
need to specify it on the command line:
</p><pre class="verbatim">          unison a.tmp ssh://username@remotehostname/a.tmp
</pre><p><span style="font-style:italic">Notes:</span>
</p><ul class="itemize"><li class="li-itemize">
If you want to put <code class="verb">a.tmp</code> some place other than your home
directory on the remote host, you can give an absolute path for it by
adding an extra slash between <code class="verb">remotehostname</code> and the beginning
of the path:
<pre class="verbatim">          unison a.tmp ssh://remotehostname//absolute/path/to/a.tmp
</pre></li><li class="li-itemize">You can give an explicit path for the <code class="verb">unison</code> executable
on the server by using the command-line option <span style="font-size:large"><span style="font-family:monospace">-servercmd
/full/path/name/of/unison</span></span> or adding
<span style="font-size:large"><span style="font-family:monospace">servercmd=/full/path/name/of/unison</span></span> to your profile (see
the <a href="#profile">Profiles</a> section). Similarly, you can specify an
explicit path for the <code class="verb">ssh</code> program using the <span style="font-size:large"><span style="font-family:monospace">-sshcmd</span></span>
option.
Extra arguments can be passed to <code class="verb">ssh</code> by setting the
<code class="verb">-sshargs</code> preference.</li><li class="li-itemize">By leveraging <span style="font-size:large"><span style="font-family:monospace">-sshcmd</span></span> and <span style="font-size:large"><span style="font-family:monospace">-sshargs</span></span>, you can
effectively use any remote shell program, not just <code class="verb">ssh</code>; just
remember that the roots are still specified with <code class="verb">ssh</code> as the
protocol, that is, they have to start with <span style="font-size:large"><span style="font-family:monospace">ssh://</span></span>.
</li></ul><!--TOC subsection id="sec20" Socket Method-->
<h3 id="sec20" class="subsection"><a id="socketmeth">Socket Method</a></h3><!--SEC END --><p>To run Unison over a socket connection, you must start a Unison
daemon process on the server. This process runs continuously,
waiting for connections over a given socket from client machines
running Unison and processing their requests in turn.</p><p>Since the socket method is not used by many people, its functionality is
rather limited. For example, the server can only deal with one client at a
time.</p><p>Note that the Unison daemon process is always started with a command-line
argument; not from a profile.</p><!--TOC subsubsection id="sec21" TCP Sockets-->
<h4 id="sec21" class="subsubsection"><a id="socket-tcp">TCP Sockets</a></h4><!--SEC END --><blockquote class="quote">
<span style="font-weight:bold"><span style="color:red">Warning:</span></span> The TCP socket method is
insecure: not only are the texts of your changes transmitted over
the network in unprotected form, it is also possible for anyone in
the world to connect to the server process and read out the contents
of your filesystem! (Of course, to do this they must understand the
protocol that Unison uses to communicate between client and server,
but all they need for this is a copy of the Unison sources.) The socket
method is provided only for expert users with specific needs; everyone
else should use the <code class="verb">ssh</code> method.
</blockquote><p>To start the daemon for connections over a TCP socket, type
</p><pre class="verbatim">       unison -socket NNNN
</pre><p>
on the server machine, where <span style="font-family:monospace">NNNN</span> is the TCP port number that the
daemon should listen on for connections from clients. (<span style="font-family:monospace">NNNN</span> can
be any large number that is not being used by some other program; if
<span style="font-family:monospace">NNNN</span> is already in use, Unison will exit with an error
message.)</p><p>Create a test directory <span style="font-family:monospace">a.tmp</span> in your home directory on the
client machine. Now type:
</p><pre>
       unison a.tmp socket://<span style="font-style:italic">remotehostname</span>:NNNN/a.tmp
</pre><p>
Note that paths specified by the client will be interpreted relative
to the directory in which you start the server process; this behavior
is different from the ssh case, where the path is relative to your home
directory on the server.
The result should be that the entire directory <span style="font-family:monospace">a.tmp</span> is
propagated from the client to the server (<span style="font-family:monospace">a.tmp</span> will be
created on the server in the directory that the server was started
from).
After finishing the first synchronization, change a few files and try
synchronizing again. You should see similar results as in the local
case.</p><p>By default Unison will listen for incoming connections on all interfaces.
If you want to limit this to certain interfaces or addresses then you
can use the <span style="font-family:monospace">-listen</span> command-line argument, specifying a host name
or an IP address to listen on. <span style="font-family:monospace">-listen</span> can be given multiple
times to listen on several addresses.</p><!--TOC subsubsection id="sec22" Unix Domain Sockets-->
<h4 id="sec22" class="subsubsection"><a id="socket-unix">Unix Domain Sockets</a></h4><!--SEC END --><p>To start the daemon for connections over a Unix domain socket, type
</p><pre class="verbatim">       unison -socket PPPP
</pre><p>
where <span style="font-family:monospace">PPPP</span> is the path to a Unix socket that the daemon should
open for connections from clients. (<span style="font-family:monospace">PPPP</span> can be any absolute or
relative path the server process has access to but it must not exist
yet; the socket is created at that path when the daemon process is
started.) You are responsible for securing access to the socket path.
For example, this can be done by controlling the permissions of
socket’s parent directory, or ensuring a restrictive <span style="font-family:monospace">umask</span> value
when starting Unison.</p><p>Clients can connect to a server over a Unix domain socket by specifying
the absolute or relative path to the socket, instead of a server address
and port number:
</p><pre>
       unison a.tmp socket://{<span style="font-style:italic">path/to/unix/socket</span>}/a.tmp
</pre><p>
(socket path is enclosed in curly braces).</p><p>Note that Unix domain sockets are local sockets (they exist in the
filesystem namespace).
One could use Unixs socket remotely, by forwarding access to the
socket by other means, for example by using <span style="font-family:monospace">spiped</span> secure pipe
daemon.</p><!--TOC subsection id="sec23" Using Unison for All Your Files-->
<h3 id="sec23" class="subsection"><a id="usingit">Using Unison for All Your Files</a></h3><!--SEC END --><p>Once you are comfortable with the basic operation of Unison, you may
find yourself wanting to use it regularly to synchronize your commonly
used files. There are several possible ways of going about this:</p><ol class="enumerate" type=1><li class="li-enumerate">
Synchronize your whole home directory, using the Ignore facility
(see the <a href="#ignore">Ignoring Paths</a> section)
to avoid synchronizing temporary files and things that only belong on
one host.
</li><li class="li-enumerate">Create a subdirectory called <span style="font-family:monospace">shared</span> (or <span style="font-family:monospace">current</span>, or
whatever) in your home directory on each host, and put all the files
you want to synchronize into this directory.
</li><li class="li-enumerate">Create a subdirectory called <span style="font-family:monospace">shared</span> (or <span style="font-family:monospace">current</span>, or
whatever) in your home directory on each host, and put <em>links to</em>
all the files you want to synchronize into this directory. Use the
<span style="font-family:monospace">follow</span> preference (see the <a href="#symlinks">Symbolic Links</a> section) to make
Unison treat these links as transparent.
</li><li class="li-enumerate">Make your home directory the root of the synchronization, but
tell Unison to synchronize only some of the files and subdirectories
within it on any given run. This can be accomplished by using the <span style="font-family:monospace">-path</span> switch
on the command line:
<pre>
       unison /home/<span style="font-style:italic">username</span> ssh://<span style="font-style:italic">remotehost</span>//home/<span style="font-style:italic">username</span> -path shared
</pre>
The <span style="font-family:monospace">-path</span> option can be used as many times as needed, to
synchronize several files or subdirectories:
<pre>
       unison /home/<span style="font-style:italic">username</span> ssh://<span style="font-style:italic">remotehost</span>//home/<span style="font-style:italic">username</span> <code class="verb">\</code>
          -path shared <code class="verb">\</code>
          -path pub <code class="verb">\</code>
          -path .netscape/bookmarks.html
</pre>
These <code class="verb">-path</code> arguments can also be put in your preference file.
See the <a href="#prefs">Preferences</a> section for an example.
</li></ol><p>Most people find that they only need to maintain a profile (or
profiles) on one of the hosts that they synchronize, since Unison is
always initiated from this host. (For example, if you’re
synchronizing a laptop with a fileserver, you’ll probably always run
Unison on the laptop.) This is a bit different from the usual
situation with asymmetric mirroring programs like <code class="verb">rdist</code>, where
the mirroring operation typically needs to be initiated from the
machine with the most recent changes. the <a href="#profile">Profiles</a> section
covers the syntax of Unison profiles, together with some sample profiles.</p><p>Some tips on improving Unison’s performance can be found on the
<a href="http://www.cis.upenn.edu/~bcpierce/unison/faq.html">Frequently
Asked Questions page</a>.</p><!--TOC subsection id="sec24" Using Unison to Synchronize More Than Two Machines-->
<h3 id="sec24" class="subsection"><a id="usingmultiple">Using Unison to Synchronize More Than Two Machines</a></h3><!--SEC END --><p>Unison is designed for synchronizing pairs of replicas. However, it is
possible to use it to keep larger groups of machines in sync by performing
multiple pairwise synchronizations.</p><p>If you need to do this, the most reliable way to set things up is to
organize the machines into a “star topology,” with one machine designated
as the “hub” and the rest as “spokes,” and with each spoke machine
synchronizing only with the hub. The big advantage of the star topology is
that it eliminates the possibility of confusing “spurious conflicts”
arising from the fact that a separate archive is maintained by Unison for
every pair of hosts that it synchronizes.</p><!--TOC subsection id="sec25" Going Further-->
<h3 id="sec25" class="subsection"><a id="further">Going Further</a></h3><!--SEC END --><p>On-line documentation for the various features of Unison
can be obtained either by typing
</p><pre class="verbatim">        unison -doc topics
</pre><p>
at the command line, or by selecting the Help menu in the graphical
user interface.
The on-line information and the printed manual are essentially identical.
</p><p>If you use Unison regularly, you should subscribe to one of the mailing
lists, to receive announcements of new versions. See
the <a href="#obtaining">Obtaining Unison</a> section.</p><p><hr></p><!--TOC section id="sec26" Basic Concepts-->
<h2 id="sec26" class="section"><a id="basics">Basic Concepts</a></h2><!--SEC END --><p>To understand how Unison works, it is necessary to discuss a few
straightforward concepts.</p><p>These concepts are developed more rigorously and at more length in a number
of papers, available at <a href="http://www.cis.upenn.edu/~bcpierce/papers"><span style="font-family:monospace">http://www.cis.upenn.edu/~bcpierce/papers</span></a>.
But the informal presentation here should be enough for most users.</p><!--TOC subsection id="sec27" Roots-->
<h3 id="sec27" class="subsection"><a id="roots">Roots</a></h3><!--SEC END --><p>A replica’s <em>root</em> tells Unison where to find a set of files to be
synchronized, either on the local machine or on a remote host.
For example,
</p><pre>
      <span style="font-style:italic">relative/path/of/root</span>
</pre><p>
specifies a local root relative to the directory where Unison is
started, while
</p><pre>
      /<span style="font-style:italic">absolute/path/of/root</span>
</pre><p>
specifies a root relative to the top of the local filesystem,
independent of where Unison is running. Remote roots can begin with
<code class="verb">ssh://</code>
to indicate that the remote server should be started with ssh:
</p><pre>
      ssh://<span style="font-style:italic">remotehost</span>//<span style="font-style:italic">absolute/path/of/root</span>
      ssh://<span style="font-style:italic">user</span>@<span style="font-style:italic">remotehost</span>/<span style="font-style:italic">relative/path/of/root</span>
</pre><p>
If the remote server is already running (in the socket mode), then the syntax
</p><pre>
      socket://<span style="font-style:italic">remotehost</span>:<span style="font-style:italic">portnum</span>//<span style="font-style:italic">absolute/path/of/root</span>
      socket://<span style="font-style:italic">remotehost</span>:<span style="font-style:italic">portnum</span>/<span style="font-style:italic">relative/path/of/root</span>
      socket://[<span style="font-style:italic">IPv6literal</span>]:<span style="font-style:italic">portnum</span>/<span style="font-style:italic">path</span>
</pre><p>
is used to specify the hostname and the port that the client Unison should
use to contact it.
Syntax
</p><pre>
      socket://{<span style="font-style:italic">path/of/socket</span>}//<span style="font-style:italic">absolute/path/of/root</span>
      socket://{<span style="font-style:italic">path/of/socket</span>}/<span style="font-style:italic">relative/path/of/root</span>
</pre><p>
is used to specify the Unix domain socket the client Unison should use to
contact the server.</p><p>The syntax for roots is based on that of URIs (described in RFC 2396).
The full grammar is:
</p><pre>
  <span style="font-style:italic">replica</span> ::= [<span style="font-style:italic">protocol</span>:]//[<span style="font-style:italic">user</span>@][<span style="font-style:italic">host</span>][:<span style="font-style:italic">port</span>][/<span style="font-style:italic">path</span>]
           |  <span style="font-style:italic">path</span>

  <span style="font-style:italic">protocol</span> ::= file
            |  socket
            |  ssh

  <span style="font-style:italic">user</span> ::= [-_a-zA-Z0-9]+

  <span style="font-style:italic">host</span> ::= [-_a-zA-Z0-9.]+
        |  \[ [a-f0-9:.]+ <span style="font-style:italic">zone</span>? \]    IPv6 literals (no future format).
        |  { [^}]+ }                   For Unix domain sockets only.

  <span style="font-style:italic">zone</span> ::= %[-_a-zA-Z0-9~%.]+

  <span style="font-style:italic">port</span> ::= [0-9]+
</pre><p>
When <code class="verb">path</code> is given without any protocol prefix, the protocol is
assumed to be <code class="verb">file:</code>. Under Windows, it is possible to
synchronize with a remote directory using the <code class="verb">file:</code> protocol over
the Windows Network Neighborhood. For example,
</p><pre class="verbatim">       unison foo //host/drive/bar
</pre><p>
synchronizes the local directory <code class="verb">foo</code> with the directory
<code class="verb">drive:\bar</code> on the machine <code class="verb">host</code>, provided that <code class="verb">host</code>
is accessible via Network Neighborhood. When the <code class="verb">file:</code> protocol
is used in this way, there is no need for a Unison server to be running
on the remote host. However, running Unison this way is only a good
idea if the remote host is reached by a very fast network connection,
since the full contents of every file in the remote replica will have to
be transferred to the local machine to detect updates.</p><p>The names of roots are <em>canonized</em> by Unison before it uses them
to compute the names of the corresponding archive files, so <span style="font-family:monospace">//saul//home/bcpierce/common</span> and <span style="font-family:monospace">//saul.cis.upenn.edu/common</span>
will be recognized as the same replica under different names.</p><!--TOC subsection id="sec28" Paths-->
<h3 id="sec28" class="subsection"><a id="paths">Paths</a></h3><!--SEC END --><p>A <em>path</em> refers to a point <em>within</em> a set of files being
synchronized; it is specified relative to the root of the replica.</p><p>Formally, a path is just a sequence of names, separated by <code class="verb">/</code>.
Note that the path separator character is always a forward slash, no
matter what operating system Unison is running on. Forward slashes
are converted to backslashes as necessary when paths are converted to
filenames in the local filesystem on a particular host.
(For example, suppose that we run Unison on a Windows system, synchronizing
the local root <code class="verb">c:\pierce</code> with the root
<code class="verb">ssh://saul.cis.upenn.edu/home/bcpierce</code> on a Unix server. Then
the path <code class="verb">current/todo.txt</code> refers to the file
<code class="verb">c:\pierce\current\todo.txt</code> on the client and
<code class="verb">/home/bcpierce/current/todo.txt</code> on the server.)</p><p>The empty path (i.e., the empty sequence of names) denotes the whole
replica. Unison displays the empty path as “<code class="verb">[root]</code>.”</p><p>If <code class="verb">p</code> is a path and <code class="verb">q</code> is a path beginning with <code class="verb">p</code>, then
<code class="verb">q</code> is said to be a <em>descendant</em> of <code class="verb">p</code>. (Each path is also a
descendant of itself.)</p><!--TOC subsection id="sec29" What is an Update?-->
<h3 id="sec29" class="subsection"><a id="updates">What is an Update?</a></h3><!--SEC END --><p>The <em>contents</em> of a path <code class="verb">p</code> in a particular replica could be a
file, a directory, a symbolic link, or absent (if <code class="verb">p</code> does not
refer to anything at all in that replica). More specifically:
</p><ul class="itemize"><li class="li-itemize">
If <code class="verb">p</code> refers to an ordinary file, then the
contents of <code class="verb">p</code> are the actual contents of this file (a string of bytes)
plus the current permission bits of the file.
</li><li class="li-itemize">If <code class="verb">p</code> refers to a symbolic link, then the contents of <code class="verb">p</code>
are just the string specifying where the link points.
</li><li class="li-itemize">If <code class="verb">p</code> refers to a directory, then the
contents of <code class="verb">p</code> are just the token “DIRECTORY” plus the current
permission bits of the directory.
</li><li class="li-itemize">If <code class="verb">p</code> does not refer to anything in this replica, then the
contents of <code class="verb">p</code> are the token “ABSENT.”
</li></ul><p>
Unison keeps a record of the contents of each path after each
successful synchronization of that path (i.e., it remembers the
contents at the last moment when they were the same in the two
replicas).</p><p>We say that a path is <em>updated</em> (in some replica) if its current
contents are different from its contents the last time it was successfully
synchronized. Note that whether a path is updated has nothing to do with
its last modification time—Unison considers only the contents when
determining whether an update has occurred. This means that touching a file
without changing its contents will <em>not</em> be recognized as an update. A
file can even be changed several times and then changed back to its original
contents; as long as Unison is only run at the end of this process, no
update will be recognized.</p><p>What Unison actually calculates is a close approximation to this
definition; see the <a href="#caveats">Caveats and Shortcomings</a> section.</p><!--TOC subsection id="sec30" What is a Conflict?-->
<h3 id="sec30" class="subsection"><a id="conflicts">What is a Conflict?</a></h3><!--SEC END --><p>A path is said to be <em>conflicting</em> if the following conditions all hold:
</p><ol class="enumerate" type=1><li class="li-enumerate">
it has been updated in one replica,
</li><li class="li-enumerate">it or any of its descendants has been updated in the other
replica,
and
</li><li class="li-enumerate">its contents in the two replicas are not identical.
</li></ol><!--TOC subsection id="sec31" Reconciliation-->
<h3 id="sec31" class="subsection"><a id="recon">Reconciliation</a></h3><!--SEC END --><p>Unison operates in several distinct stages:
</p><ol class="enumerate" type=1><li class="li-enumerate">
On each host, it compares its archive file (which records
the state of each path in the replica when it was last synchronized)
with the current contents of the replica, to determine which paths
have been updated.
</li><li class="li-enumerate">It checks for “false conflicts” — paths that have been
updated on both replicas, but whose current values are identical.
These paths are silently marked as synchronized in the archive files
in both replicas.
</li><li class="li-enumerate">It displays all the updated paths to the user. For updates that
do not conflict, it suggests a default action (propagating the new
contents from the updated replica to the other). Conflicting updates
are just displayed. The user is given an opportunity to examine the
current state of affairs, change the default actions for
nonconflicting updates, and choose actions for conflicting updates.
</li><li class="li-enumerate">It performs the selected actions, one at a time. Each action is
performed by first transferring the new contents to a temporary file
on the receiving host, then atomically moving them into place.
</li><li class="li-enumerate">It updates its archive files to reflect the new state of the
replicas.
</li></ol><!--TOC subsection id="sec32" Invariants-->
<h3 id="sec32" class="subsection"><a id="failures">Invariants</a></h3><!--SEC END --><p>Given the importance and delicacy of the job that it performs, it is
important to understand both what a synchronizer does under normal
conditions and what can happen under unusual conditions such as system
crashes and communication failures.</p><p>Unison is careful to protect both its internal state and the state of
the replicas at every point in this process. Specifically, the
following guarantees are enforced:
</p><ul class="itemize"><li class="li-itemize">
At every moment, each path in each replica has either (1) its <em>original</em> contents (i.e., no change at all has been made to this
path), or (2) its <em>correct</em> final contents (i.e., the value that the
user expected to be propagated from the other replica).
</li><li class="li-itemize">At every moment, the information stored on disk about Unison’s
private state can be either (1) unchanged, or (2) updated to reflect
those paths that have been successfully synchronized.
</li></ul><p>
The upshot is that it is safe to interrupt Unison at any time, either
manually or accidentally. [Caveat: the above is <em>almost</em> true there
are occasionally brief periods where it is not (and, because of
shortcoming of the Posix filesystem API, cannot be); in particular, when
it is copying a file onto a directory or vice versa, it must first move
the original contents out of the way. If Unison gets
interrupted during one of these periods, some manual cleanup may be
required. In this case, a file called <span style="font-family:monospace">DANGER.README</span> will be left
in the <span style="font-family:monospace">.unison</span> directory, containing information about the operation that
was interrupted. The next time you try to run Unison, it will notice this
file and warn you about it.]</p><p>If an interruption happens while it is propagating updates, then there
may be some paths for which an update has been propagated but which
have not been marked as synchronized in Unison’s archives. This is no
problem: the next time Unison runs, it will detect changes to these
paths in both replicas, notice that the contents are now equal, and
mark the paths as successfully updated when it writes back its private
state at the end of this run.</p><p>If Unison is interrupted, it may sometimes leave temporary working files
(with suffix <code class="verb">.tmp</code>) in the replicas. It is safe to delete these
files. Also, if the <code class="verb">backups</code> flag is set, Unison will
leave around old versions of files that it overwrites, with names like
<code class="verb">file.0.unison.bak</code>. These can be deleted safely when they are no
longer wanted.</p><p>Unison is not bothered by clock skew between the different hosts on
which it is running. It only performs comparisons between timestamps
obtained from the same host, and the only assumption it makes about
them is that the clock on each system always runs forward.</p><p>If Unison finds that its archive files have been deleted (or that the
archive format has changed and they cannot be read, or that they don’t
exist because this is the first run of Unison on these particular
roots), it takes a conservative approach: it behaves as though the
replicas had both been completely empty at the point of the last
synchronization. The effect of this is that, on the first run, files
that exist in only one replica will be propagated to the other, while
files that exist in both replicas but are unequal will be marked as
conflicting.</p><p>Touching a file without changing its contents should never affect whether or
not Unison does an update. (When running with the fastcheck preference set
to true—the default on Unix systems—Unison uses file modtimes for a
quick first pass to tell which files have definitely not changed; then, for
each file that might have changed, it computes a fingerprint of the file’s
contents and compares it against the last-synchronized contents. Also, the
<code class="verb">-times</code> option allows you to synchronize file times, but it does not
cause identical files to be changed; Unison will only modify the file
times.)</p><p>It is safe to “brainwash” Unison by deleting its archive files
<em>on both replicas</em>. The next time it runs, it will assume that
all the files it sees in the replicas are new.</p><p>It is safe to modify files while Unison is working. If Unison
discovers that it has propagated an out-of-date change, or that the
file it is updating has changed on the target replica, it will signal
a failure for that file. Run Unison again to propagate the latest
change.
</p><p>Changes to the ignore patterns from the user interface (e.g., using
the ‘i’ key) are immediately reflected in the current profile.</p><!--TOC subsection id="sec33" Caveats and Shortcomings-->
<h3 id="sec33" class="subsection"><a id="caveats">Caveats and Shortcomings</a></h3><!--SEC END --><p>Here are some things to be careful of when using Unison.</p><ul class="itemize"><li class="li-itemize">
In the interests of speed, the update detection algorithm may
(depending on which OS architecture that you run Unison on)
actually use an approximation to the definition given in
the <a href="#updates">What is an Update?</a> section.<p>In particular, the Unix
implementation does not compare the actual contents of files to their
previous contents, but simply looks at each file’s inode number and
modtime; if neither of these have changed, then it concludes that the
file has not been changed.</p><p>Under normal circumstances, this approximation is safe, in the sense
that it may sometimes detect “false updates” but will never miss a real
one. However, it is possible to fool it, for example by using
<code class="verb">retouch</code> to change a file’s modtime back to a time in the past.
</p></li><li class="li-itemize">If you synchronize between a single-user filesystem and a shared
Unix server, you should pay attention to your permission bits: by
default, Unison will synchronize permissions verbatim, which may leave
group-writable files on the server that could be written over by a lot of
people.<p>You can control this by setting your <code class="verb">umask</code> on both computers to
something like 022, masking out the “world write” and “group write”
permission bits.</p><p>Unison does not synchronize the <code class="verb">setuid</code> and <code class="verb">setgid</code> bits, for
security.</p></li><li class="li-itemize">The graphical user interface is single-threaded. This
means that if Unison is performing some long-running operation, the
display will not be repainted until it finishes. We recommend not
trying to do anything with the user interface while Unison is in the
middle of detecting changes or propagating files.</li><li class="li-itemize">Unison does not understand hard links.</li><li class="li-itemize">It is important to be a little careful when renaming directories
containing <span style="font-family:monospace">ignore</span>d files.<p>For example, suppose Unison is synchronizing directory A between the two
machines called the “local” and the “remote” machine; suppose directory
A contains a subdirectory D; and suppose D on the local machine contains a
file or subdirectory P that matches an ignore directive in the profile used
to synchronize. Thus path A/D/P exists on the local machine but not on the
remote machine.</p><p>If D is renamed to D’ on the remote machine, and this change is
propagated to the local machine, all such files or subdirectories P
will be deleted. This is because Unison sees the rename as a delete and a
separate create: it deletes the old directory (including the ignored files)
and creates a new one (<em>not</em> including the ignored files, since they
are completely invisible to it).
</p></li></ul><p><hr></p><!--TOC section id="sec34" Reference Guide-->
<h2 id="sec34" class="section"><a id="reference">Reference Guide</a></h2><!--SEC END --><p>This section covers the features of Unison in detail.</p><!--TOC subsection id="sec35" Running Unison-->
<h3 id="sec35" class="subsection"><a id="running">Running Unison</a></h3><!--SEC END --><p>There are several ways to start Unison.
</p><ul class="itemize"><li class="li-itemize">
Typing “<span style="font-family:monospace">unison </span><span style="font-family:monospace"><span style="font-style:italic">profile</span></span>” on the command line. Unison
will look for a file <span style="font-family:monospace"><span style="font-style:italic">profile</span></span><span style="font-family:monospace">.prf</span> in the <code class="verb">.unison</code>
directory. If this file does not specify a pair of roots, Unison will
prompt for them and add them to the information specified by the profile.
</li><li class="li-itemize">Typing “<span style="font-family:monospace">unison </span><span style="font-family:monospace"><span style="font-style:italic">profile</span></span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">root1</span></span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">root2</span></span>” on the command
line.
In this case, Unison will use <span style="font-family:monospace"><span style="font-style:italic">profile</span></span>, which should not contain
any <span style="font-family:monospace">root</span> directives.
</li><li class="li-itemize">Typing “<span style="font-family:monospace">unison </span><span style="font-family:monospace"><span style="font-style:italic">root1</span></span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">root2</span></span>” on the command line. This
has the same effect as typing “<span style="font-family:monospace">unison default </span><span style="font-family:monospace"><span style="font-style:italic">root1</span></span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">root2</span></span>.”
</li><li class="li-itemize">Typing just “<span style="font-family:monospace">unison</span>” (or invoking Unison by clicking on
a desktop icon). In this case, Unison will ask for the profile to use
for synchronization (or create a new one, if necessary).
</li></ul><!--TOC subsection id="sec36" The <span style="font-family:monospace">.unison</span> Directory-->
<h3 id="sec36" class="subsection"><a id="unisondir">The <span style="font-family:monospace">.unison</span> Directory</a></h3><!--SEC END --><p>Unison stores a variety of information in a private directory on each
host. If the environment variable <span style="font-family:monospace">UNISON</span> is defined, then its
value will be used as the path/folder name for this directory.
This can be just a name, or a path.</p><p>A name on it’s own, for example <span style="font-family:monospace">UNISON=mytestname</span> will
place a folder in the same directory that the Unison binary was run
in, with that name. Using a path like <span style="font-family:monospace">UNISON=../mytestname2</span>
will place that folder in the folder above where the Unison binary was
run from.</p><p>If <span style="font-family:monospace">UNISON</span> is not defined, then the directory depends on which
operating system you are using. In Unix, the default is to use
<span style="font-family:monospace">$HOME/.unison</span>.
In Windows, if the environment variable
<span style="font-family:monospace">USERPROFILE</span> is defined, then the directory will be
<span style="font-family:monospace">$USERPROFILE</span>\<span style="font-family:monospace">.unison</span>;
otherwise if <span style="font-family:monospace">HOME</span> is defined, it will be
<span style="font-family:monospace">$HOME</span>\<span style="font-family:monospace">.unison</span>;
otherwise, it will be
<span style="font-family:monospace">c:</span>\<span style="font-family:monospace">.unison</span>.
On OS X,
<span style="font-family:monospace">$HOME/.unison</span> will be used if it is present, but
<span style="font-family:monospace">$HOME/Library/Application Support/Unison</span> will be created and used by
default.</p><p>The archive file for each replica is found in the <span style="font-family:monospace">.unison</span>
directory on that replica’s host. Profiles (described below) are
always taken from the <span style="font-family:monospace">.unison</span> directory on the client host.</p><p>Note that Unison maintains a completely different set of archive files
for each pair of roots.</p><p>We do not recommend synchronizing the whole <span style="font-family:monospace">.unison</span> directory, as this
will involve frequent propagation of large archive files. It should be safe
to do it, though, if you really want to. Synchronizing just the profile
files in the <span style="font-family:monospace">.unison</span> directory is definitely OK.</p><!--TOC subsection id="sec37" Archive Files-->
<h3 id="sec37" class="subsection"><a id="archives">Archive Files</a></h3><!--SEC END --><p>The name of the archive file on each replica is calculated from
</p><ul class="itemize"><li class="li-itemize">
the <em>canonical names</em> of all the hosts (short names like
<code class="verb">saul</code> are converted into full addresses like <code class="verb">saul.cis.upenn.edu</code>),
</li><li class="li-itemize">the paths to the replicas on all the hosts (again, relative
pathnames, symbolic links, etc. are converted into full, absolute paths), and
</li><li class="li-itemize">an internal version number that is changed whenever a new Unison
release changes the format of the information stored in the archive.
</li></ul><p>
This method should work well for most users. However, it is occasionally
useful to change the way archive names are generated. Unison provides
two ways of doing this.</p><p>The function that finds the canonical hostname of the local host (which
is used, for example, in calculating the name of the archive file used to
remember which files have been synchronized) normally uses the
<code class="verb">gethostname</code> operating system call. However, if the environment
variable <code class="verb">UNISONLOCALHOSTNAME</code> is set, its value will be used
instead. This makes it easier to use Unison in situations where a
machine’s name changes frequently (e.g., because it is a laptop and gets
moved around a lot).</p><p>A more powerful way of changing archive names is provided by the
<code class="verb">rootalias</code> preference. The preference file may contain any number of
lines of the form:
</p><pre>
    rootalias = //<span style="font-style:italic">hostnameA</span>//<span style="font-style:italic">path-to-replicaA</span> -&gt; //<span style="font-style:italic">hostnameB</span>/<span style="font-style:italic">path-to-replicaB</span>
</pre><p>
When calculating the name of the archive files for a given pair of roots,
Unison replaces any root that matches the left-hand side of any rootalias
rule by the corresponding right-hand side.</p><p>So, if you need to relocate a root on one of the hosts, you can add a
rule of the form:
</p><pre>
    rootalias = //<span style="font-style:italic">new-hostname</span>//<span style="font-style:italic">new-path</span> -&gt; //<span style="font-style:italic">old-hostname</span>/<span style="font-style:italic">old-path</span>
</pre><p>
Note that root aliases are case-sensitive, even on case-insensitive file
systems.</p><p><em>Warning</em>: The <code class="verb">rootalias</code> option is dangerous and should only
be used if you are sure you know what you’re doing. In particular, it
should only be used if you are positive that either (1) both the original
root and the new alias refer to the same set of files, or (2) the files
have been relocated so that the original name is now invalid and will
never be used again. (If the original root and the alias refer to
different sets of files, Unison’s update detector could get confused.)
After introducing a new <code class="verb">rootalias</code>, it is a good idea to run Unison
a few times interactively (with the <code class="verb">batch</code> flag off, etc.) and
carefully check that things look reasonable—in particular, that update
detection is working as expected.</p><!--TOC subsection id="sec38" Preferences-->
<h3 id="sec38" class="subsection"><a id="prefs">Preferences</a></h3><!--SEC END --><p>Many details of Unison’s behavior are configurable by user-settable
“preferences.”</p><p>Some preferences are boolean-valued; these are often called <em>flags</em>.
Others take numeric or string arguments, indicated in the preferences
list by <span style="font-family:monospace">n</span> or <span style="font-family:monospace">xxx</span>. Some string arguments take the backslash as
an escape to include the next character literally; this is mostly useful
to escape a space or the backslash; a trailing backslash is ignored and is
useful to protect a trailing whitespace in the string that would otherwise
be trimmed. Most of the string preferences can be given several times;
the arguments are accumulated into a list internally.</p><p>There are two ways to set the values of preferences: temporarily, by
providing command-line arguments to a particular run of Unison, or
permanently, by adding commands to a <em>profile</em> in the <span style="font-family:monospace">.unison</span>
directory on the client host. The order of preferences (either on the
command line or in preference files) is not significant. On the command
line, preferences and other arguments (the profile name and roots) can be
intermixed in any order.</p><p>To set the value of a preference <span style="font-family:monospace">p</span> from the command line, add an
argument <span style="font-family:monospace">-p</span> (for a boolean flag) or <span style="font-family:monospace">-p n</span> or <span style="font-family:monospace">-p xxx</span> (for
a numeric or string preference) anywhere on the command line. To set a
boolean flag to <code class="verb">false</code> on the command line, use <span style="font-family:monospace">-p=false</span>.</p><p>Here are all the preferences supported by Unison. This list can be
obtained by typing <span style="font-family:monospace">unison -help</span>.
</p><blockquote class="quote">
<pre class="verbatim">Usage: unison [options]
    or unison root1 root2 [options]
    or unison profilename [options]

Basic options:

  General:
   -doc xxx            show documentation ('-doc topics' lists topics)
   -version            print version and exit

  What to sync:
   -group              synchronize group attributes
   -ignore xxx         add a pattern to the ignore list
   -ignorenot xxx      add a pattern to the ignorenot list
   -nocreation xxx     prevent file creations on one replica
   -nodeletion xxx     prevent file deletions on one replica
   -noupdate xxx       prevent file updates and deletions on one replica
   -owner              synchronize owner
   -path xxx           path to synchronize
   -perms n            part of the permissions which is synchronized
   -root xxx           root of a replica (should be used exactly twice)
   -times              synchronize modification times

  How to sync:
   -batch              batch mode: ask no questions at all

  How to sync (text interface (CLI) only):
   -auto               automatically accept default (nonconflicting) actions
   -silent             print nothing except error messages
   -terse              suppress status messages

  Text interface (CLI):
   -i                  interactive profile mode (text UI); command-line only

Advanced options:

  Fine-tune sync:
   -acl                synchronize ACLs
   -atomic xxx         add a pattern to the atomic list
   -follow xxx         add a pattern to the follow list
   -force xxx          force changes from this replica to the other
   -forcepartial xxx   add a pattern to the forcepartial list
   -ignorecase xxx     identify upper/lowercase filenames (true/false/default)
   -immutable xxx      add a pattern to the immutable list
   -immutablenot xxx   add a pattern to the immutablenot list
   -links xxx          allow the synchronization of symbolic links
                       (true/false/default)
   -merge xxx          add a pattern to the merge list
   -nocreationpartial xxx add a pattern to the nocreationpartial list
   -nodeletionpartial xxx add a pattern to the nodeletionpartial list
   -noupdatepartial xxx add a pattern to the noupdatepartial list
   -prefer xxx         choose this replica's version for conflicting changes
   -preferpartial xxx  add a pattern to the preferpartial list
   -rsrc xxx           synchronize resource forks (true/false/default)
   -xattrignore xxx    add a pattern to the xattrignore list
   -xattrignorenot xxx add a pattern to the xattrignorenot list
   -xattrs             synchronize extended attributes (xattrs)

  How to sync:
   -backup xxx         add a pattern to the backup list
   -backupcurr xxx     add a pattern to the backupcurr list
   -backupcurrnot xxx  add a pattern to the backupcurrnot list
   -backupdir xxx      directory for storing centralized backups
   -backuploc xxx      where backups are stored ('local' or 'central')
   -backupnot xxx      add a pattern to the backupnot list
   -backupprefix xxx   prefix for the names of backup files
   -backups            (deprecated) keep backup copies of all files (see also
                       'backup')
   -backupsuffix xxx   a suffix to be added to names of backup files
   -confirmbigdel      ask about whole-replica (or path) deletes (default true)
   -confirmmerge       ask for confirmation before committing results of a merge
   -copyonconflict     keep copies of conflicting files
   -dontchmod          when set, never use the chmod system call
   -fastcheck xxx      do fast update detection (true/false/default)
   -fat                use appropriate options for FAT filesystems
   -ignoreinodenumbers ignore inode number changes when detecting updates
   -maxbackups n       number of backed up versions of a file
   -numericids         don't map uid/gid values by user/group names
   -sortbysize         list changed files by size, not name
   -sortfirst xxx      add a pattern to the sortfirst list
   -sortlast xxx       add a pattern to the sortlast list
   -sortnewfirst       list new before changed files

  How to sync (text interface (CLI) only):
   -repeat xxx         synchronize repeatedly (text interface only)
   -retry n            re-try failed synchronizations N times (text ui only)

  Text interface (CLI):
   -color xxx          use color output for text UI (true/false/default)
   -dumbtty            do not change terminal settings in text UI

  Graphical interface (GUI):
   -height n           height (in lines) of main window in graphical interface

  Remote connections:
   -addversionno       add version number to name of unison on server
   -clientHostName xxx set host name of client
   -halfduplex         (deprecated) force half-duplex communication with the
                       server
   -killserver         kill server when done (even when using sockets)
   -listen xxx         listen on this name or addr in server socket mode (can
                       repeat)
   -rsync              activate the rsync transfer mode (default true)
   -servercmd xxx      name of unison executable on remote server
   -socket xxx         act as a server on a socket
   -sshargs xxx        other arguments (if any) for remote shell command
   -sshcmd xxx         path to the ssh executable
   -stream             (deprecated) use a streaming protocol for transferring
                       file contents (default true)
   -testserver         exit immediately after the connection to the server
   -xferbycopying      optimize transfers using local copies (default true)

  Archive management:
   -ignorearchives     ignore existing archive files

  Other:
   -addprefsto xxx     file to add new prefs to
   -contactquietly     suppress the 'contacting server' message during startup
   -copymax n          maximum number of simultaneous copyprog transfers
   -copyprog xxx       external program for copying large files
   -copyprogrest xxx   variant of copyprog for resuming partial transfers
   -copythreshold n    use copyprog on files bigger than this (if &gt;=0, in Kb)
   -diff xxx           set command for showing differences between files
   -ignorelocks        ignore locks left over from previous run (dangerous!)
   -include xxx        include a profile's preferences
   -key xxx            define a keyboard shortcut for this profile (in some UIs)
   -label xxx          provide a descriptive string label for this profile
   -log                record actions in logfile (default true)
   -logfile xxx        logfile name
   -maxerrors n        maximum number of errors before a directory transfer is
                       aborted
   -maxsizethreshold n prevent transfer of files bigger than this (if &gt;=0, in
                       Kb)
   -maxthreads n       maximum number of simultaneous file transfers
   -mountpoint xxx     abort if this path does not exist
   -rootalias xxx      register alias for canonical root names
   -showarchive        show 'true names' (for rootalias) of roots and archive
   -source xxx         include a file's preferences
   -ui xxx             select UI ('text' or 'graphic'); command-line only
   -unicode xxx        assume Unicode encoding in case insensitive mode
   -watch              when set, use a file watcher process to detect changes

Expert options:
   -debug xxx          debug module xxx ('all' -&gt; everything, 'verbose' -&gt; more)
   -dumparchives       dump contents of archives just after loading
   -fastercheckUNSAFE  skip computing fingerprints for new files (experts only!)
   -selftest           run internal tests and exit

</pre>
</blockquote><p>Here, in more detail, is what they do. Many are discussed in greater detail
in other sections of the manual.</p><p>It should be noted that some command-line arguments are handled specially during startup, including <code class="verb">-doc</code>, <code class="verb">-help</code>, <code class="verb">-version</code>, <code class="verb">-socket</code>, and <code class="verb">-ui</code>. They are expected to appear on the command-line only, not in a profile. In particular, <code class="verb">-version</code> and <code class="verb">-doc</code> will print to the standard output, so they only make sense if invoked from the command-line (and not a click-launched gui that has no standard output). Furthermore, the actions associated with these command-line arguments are executed without loading a profile or doing the usual command-line parsing.
</p><dl class="description"><dt class="dt-description">
<span style="font-weight:bold">acl </span></dt><dd class="dd-description">
When this flag is set to <code class="verb">true</code>, the ACLs of files and directories are synchronized. The type of ACLs depends on the platform and filesystem support. On Unix-like platforms it can be NFSv4 ACLs, for example.</dd><dt class="dt-description"><span style="font-weight:bold">addprefsto <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
By default, new preferences added by Unison (e.g., new <code class="verb">ignore</code> clauses) will be appended to whatever preference file Unison was told to load at the beginning of the run. Setting the preference <span style="font-family:monospace">addprefsto </span><span style="font-family:monospace"><span style="font-style:italic">filename</span></span> makes Unison add new preferences to the file named <span style="font-family:monospace"><span style="font-style:italic">filename</span></span> instead.</dd><dt class="dt-description"><span style="font-weight:bold">addversionno </span></dt><dd class="dd-description">
When this flag is set to <span style="font-family:monospace">true</span>, Unison will use <span style="font-family:monospace">unison-</span><span style="font-family:monospace"><span style="font-style:italic">currentmajorversionnumber</span></span> instead of just <code class="verb">unison</code> as the remote server command (note that the minor version number is dropped – e.g., unison-2.51). This allows multiple binaries for different versions of unison to coexist conveniently on the same server: whichever version is run on the client, the same version will be selected on the server.</dd><dt class="dt-description"><span style="font-weight:bold">atomic <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference specifies paths for directories whose contents will be considered as a group rather than individually when they are both modified. The backups are also made atomically in this case. The option <span style="font-family:monospace">backupcurr</span> however has no effect on atomic directories.</dd><dt class="dt-description"><span style="font-weight:bold">auto </span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes the user interface to skip asking for confirmations on non-conflicting changes. (More precisely, when the user interface is done setting the propagation direction for one entry and is about to move to the next, it will skip over all non-conflicting entries and go directly to the next conflict.)</dd><dt class="dt-description"><span style="font-weight:bold">backup <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-backup </span><span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> causes Unison to keep backup files for each path that matches <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span>; directories (nor their permissions or any other metadata) are not backed up. These backup files are kept in the directory specified by the <code class="verb">backuplocation</code> preference. The backups are named according to the <code class="verb">backupprefix</code> and <code class="verb">backupsuffix</code> preferences. The number of versions that are kept is determined by the <code class="verb">maxbackups</code> preference.<p>The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is described in the <a href="#pathspec">Path Specification</a> section.</p></dd><dt class="dt-description"><span style="font-weight:bold">backupcurr <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-backupcurr </span><span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> causes Unison to keep a backup of the <em>current</em> version of every file matching <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span>. This file will be saved as a backup with version number 000. Such backups can be used as inputs to external merging programs, for instance. See the documentation for the <code class="verb">merge</code> preference. For more details, see the <a href="#merge">Merging Conflicting Versions</a> section.<p>The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is described in the <a href="#pathspec">Path Specification</a> section.</p></dd><dt class="dt-description"><span style="font-weight:bold">backupcurrnot <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Exceptions to <code class="verb">backupcurr</code>, like the <code class="verb">ignorenot</code> preference.</dd><dt class="dt-description"><span style="font-weight:bold">backupdir <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
If this preference is set, Unison will use it as the name of the directory used to store backup files specified by the <span style="font-family:monospace">backup</span> preference, when <span style="font-family:monospace">backuplocation</span> is set to <code class="verb">central</code>. It is checked <em>after</em> the <span style="font-family:monospace">UNISONBACKUPDIR</span> environment variable.</dd><dt class="dt-description"><span style="font-weight:bold">backuploc <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference determines whether backups should be kept locally, near the original files, or in a central directory specified by the <span style="font-family:monospace">backupdir</span> preference. If set to <code class="verb">local</code>, backups will be kept in the same directory as the original files, and if set to <code class="verb">central</code>, <span style="font-family:monospace">backupdir</span> will be used instead.</dd><dt class="dt-description"><span style="font-weight:bold">backupnot <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
The values of this preference specify paths or individual files or regular expressions that should <em>not</em> be backed up, even if the <span style="font-family:monospace">backup</span> preference selects them—i.e., it selectively overrides <span style="font-family:monospace">backup</span>.</dd><dt class="dt-description"><span style="font-weight:bold">backupprefix <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When a backup for a file <code class="verb">NAME</code> is created, it is stored in a directory specified by <span style="font-family:monospace">backuplocation</span>, in a file called <span style="font-family:monospace">backupprefix</span><code class="verb">NAME</code><span style="font-family:monospace">backupsuffix</span>. <span style="font-family:monospace">backupprefix</span> can include a directory name (causing Unison to keep all backup files for a given directory in a subdirectory with this name), and both <span style="font-family:monospace">backupprefix</span> and <span style="font-family:monospace">backupsuffix</span> can contain the string <span style="font-family:monospace"><span style="font-style:italic">$VERSION</span></span>, which will be replaced by the <em>age</em> of the backup (1 for the most recent, 2 for the second most recent, and so on...). This keyword is ignored if it appears in a directory name in the prefix; if it does not appear anywhere in the prefix or the suffix, it will be automatically placed at the beginning of the suffix. <p>One thing to be careful of: If the <span style="font-family:monospace">backuploc</span> preference is set to <span style="font-family:monospace">local</span>, Unison will automatically ignore <em>all</em> files whose prefix and suffix match <span style="font-family:monospace">backupprefix</span> and <span style="font-family:monospace">backupsuffix</span>. So be careful to choose values for these preferences that are sufficiently different from the names of your real files.</p></dd><dt class="dt-description"><span style="font-weight:bold">backups </span></dt><dd class="dd-description">
<em>(Deprecated)</em> Setting this flag to true is equivalent to setting <span style="font-family:monospace">backuplocation</span> to <span style="font-family:monospace">local</span> and <span style="font-family:monospace">backup</span> to <code class="verb">Name *</code>.</dd><dt class="dt-description"><span style="font-weight:bold">backupsuffix <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
See <span style="font-family:monospace">backupprefix</span> for full documentation.</dd><dt class="dt-description"><span style="font-weight:bold">batch </span></dt><dd class="dd-description">
When this is set to <span style="font-family:monospace">true</span>, the user interface will ask no questions at all. Non-conflicting changes will be propagated; conflicts will be skipped.</dd><dt class="dt-description"><span style="font-weight:bold">clientHostName <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When specified, the host name of the client will not be guessed and the provided host name will be used to find the archive.</dd><dt class="dt-description"><span style="font-weight:bold">color <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag enables color output in text mode user interface. When set to <span style="font-family:monospace">false</span>, all color output is disabled. Default is to enable color if the <span style="font-family:monospace">NO_COLOR</span> environment variable is not set.</dd><dt class="dt-description"><span style="font-weight:bold">confirmbigdel </span></dt><dd class="dd-description">
When this is set to <span style="font-family:monospace">true</span>, Unison will request an extra confirmation if it appears that the entire replica has been deleted, before propagating the change. If the <span style="font-family:monospace">batch</span> flag is also set, synchronization will be aborted. When the <span style="font-family:monospace">path</span> preference is used, the same confirmation will be requested for top-level paths. (At the moment, this flag only affects the text user interface.) See also the <span style="font-family:monospace">mountpoint</span> preference.</dd><dt class="dt-description"><span style="font-weight:bold">confirmmerge </span></dt><dd class="dd-description">
Setting this preference causes both the text and graphical interfaces to ask the user if the results of a merge command may be committed to the replica or not. Since the merge command works on temporary files, the user can then cancel all the effects of applying the merge if it turns out that the result is not satisfactory. In batch-mode, this preference has no effect. Default is false.</dd><dt class="dt-description"><span style="font-weight:bold">contactquietly </span></dt><dd class="dd-description">
If this flag is set, Unison will skip displaying the ‘Contacting server’ message (which some users find annoying) during startup.</dd><dt class="dt-description"><span style="font-weight:bold">copymax <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
A number indicating how many instances of the external copying utility Unison is allowed to run simultaneously (default to 1).</dd><dt class="dt-description"><span style="font-weight:bold">copyonconflict </span></dt><dd class="dd-description">
When this flag is set, Unison will make a copy of files that would otherwise be overwritten or deleted in case of conflicting changes, and more generally whenever the default behavior is overridden. This makes it possible to automatically resolve conflicts in a fairly safe way when synchronizing continuously, in combination with the <code class="verb">-repeat watch</code> and <code class="verb">-prefer newer</code> preferences.</dd><dt class="dt-description"><span style="font-weight:bold">copyprog <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
A string giving the name of an external program that can be used to copy large files efficiently (plus command-line switches telling it to copy files in-place). The default setting invokes <span style="font-family:monospace">rsync</span> with appropriate options—most users should not need to change it.</dd><dt class="dt-description"><span style="font-weight:bold">copyprogrest <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
A variant of <span style="font-family:monospace">copyprog</span> that names an external program that should be used to continue the transfer of a large file that has already been partially transferred. Typically, <span style="font-family:monospace">copyprogrest</span> will just be <span style="font-family:monospace">copyprog</span> with one extra option (e.g., <span style="font-family:monospace">--partial</span>, for rsync). The default setting invokes <span style="font-family:monospace">rsync</span> with appropriate options—most users should not need to change it.</dd><dt class="dt-description"><span style="font-weight:bold">copythreshold <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
A number indicating above what filesize (in kilobytes) Unison should use the external copying utility specified by <span style="font-family:monospace">copyprog</span>. Specifying 0 will cause <em>all</em> copies to use the external program; a negative number will prevent any files from using it. The default is -1. See the <a href="#speeding">Making Unison Faster on Large Files</a> section for more information.</dd><dt class="dt-description"><span style="font-weight:bold">debug <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference is used to make Unison print various sorts of information about what it is doing internally on the standard error stream. It can be used many times, each time with the name of a module for which debugging information should be printed. Possible arguments for <code class="verb">debug</code> can be found by looking for calls to <code class="verb">Util.debug</code> in the sources (using, e.g., <code class="verb">grep</code>). Setting <code class="verb">-debug all</code> causes information from <em>all</em> modules to be printed (this mode of usage is the first one to try, if you are trying to understand something that Unison seems to be doing wrong); <code class="verb">-debug verbose</code> turns on some additional debugging output from some modules (e.g., it will show exactly what bytes are being sent across the network).</dd><dt class="dt-description"><span style="font-weight:bold">diff <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference can be used to control the name and command-line arguments of the system utility used to generate displays of file differences. The default is ‘<code class="verb">diff -u OLDER NEWER</code>’. If the value of this preference contains the substrings CURRENT1 and CURRENT2, these will be replaced by the names of the files to be diffed. If the value of this preference contains the substrings NEWER and OLDER, these will be replaced by the names of files to be diffed, NEWER being the most recently modified file of the two. Without any of these substrings, the two filenames will be appended to the command. In all cases, the filenames are suitably quoted.</dd><dt class="dt-description"><span style="font-weight:bold">doc <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
The command-line argument <span style="font-family:monospace">-doc </span><span style="font-family:monospace"><span style="font-style:italic">secname</span></span> causes unison to display section <span style="font-family:monospace"><span style="font-style:italic">secname</span></span> of the manual on the standard output and then exit. Use <code class="verb">-doc all</code> to display the whole manual, which includes exactly the same information as the printed and HTML manuals, modulo formatting. Use <code class="verb">-doc topics</code> to obtain a list of the names of the various sections that can be printed.</dd><dt class="dt-description"><span style="font-weight:bold">dontchmod </span></dt><dd class="dd-description">
By default, Unison uses the ’chmod’ system call to set the permission bits of files after it has copied them. But in some circumstances (and under some operating systems), the chmod call always fails. Setting this preference completely prevents Unison from ever calling chmod.</dd><dt class="dt-description"><span style="font-weight:bold">dumbtty </span></dt><dd class="dd-description">
When set to <code class="verb">true</code>, this flag makes the text mode user interface avoid trying to change any of the terminal settings. (Normally, Unison puts the terminal in ‘raw mode’, so that it can do things like overwriting the current line.) This is useful, for example, when Unison runs in a shell inside of Emacs. <p>When <code class="verb">dumbtty</code> is set, commands to the user interface need to be followed by a carriage return before Unison will execute them. (When it is off, Unison recognizes keystrokes as soon as they are typed.)</p><p>This preference has no effect on the graphical user interface.</p></dd><dt class="dt-description"><span style="font-weight:bold">dumparchives </span></dt><dd class="dd-description">
When this preference is set, Unison will create a file unison.dump on each host, containing a text summary of the archive, immediately after loading it.</dd><dt class="dt-description"><span style="font-weight:bold">fastcheck <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When this preference is set to <code class="verb">true</code>, Unison will use the modification time and length of a file as a
‘pseudo inode number’ when scanning replicas for updates, instead of reading the full contents of every file. (This does not apply to the very first run, when Unison will always scan all files regardless of this switch). Under Windows, this may cause Unison to miss propagating an update if the modification time and length of the file are both unchanged by the update. However, Unison will never <em>overwrite</em> such an update with a change from the other replica, since it always does a safe check for updates just before propagating a change. Thus, it is reasonable to use this switch under Windows most of the time and occasionally run Unison once with <span style="font-family:monospace">fastcheck</span> set to <code class="verb">false</code>, if you are worried that Unison may have overlooked an update. For backward compatibility, <code class="verb">yes</code>, <code class="verb">no</code>, and <code class="verb">default</code> can be used in place of <code class="verb">true</code>, <code class="verb">false</code>, and <code class="verb">auto</code>. See the <a href="#fastcheck">Fast Update Detection</a> section for more information.</dd><dt class="dt-description"><span style="font-weight:bold">fastercheckUNSAFE </span></dt><dd class="dd-description">
THIS FEATURE IS STILL EXPERIMENTAL AND SHOULD BE USED WITH EXTREME CAUTION. <p>When this flag is set to <span style="font-family:monospace">true</span>, Unison will compute a ’pseudo-fingerprint’ the first time it sees a file (either because the file is new or because Unison is running for the first time). This enormously speeds update detection, but it must be used with care, as it can cause Unison to miss conflicts: If a given path in the filesystem contains files on <em>both</em> sides that Unison has not yet seen, and if those files have the same length but different contents, then Unison will not notice the presence of a conflict. If, later, one of the files is changed, the changed file will be propagated, overwriting the other. </p><p>Moreover, even when the files are initially identical, setting this flag can lead to potentially confusing behavior: if a newly created file is later touched without being modified, Unison will treat this conservatively as a potential change (since it has no record of the earlier contents) and show it as needing to be propagated to the other replica. </p><p>Most users should leave this flag off – the small time savings of not fingerprinting new files is not worth the cost in terms of safety. However, it can be very useful for power users with huge replicas that are known to be already synchronized (e.g., because one replica is a newly created duplicate of the other, or because they have previously been synchronized with Unison but Unison’s archives need to be rebuilt). In such situations, it is recommended that this flag be set only for the initial run of Unison, so that new archives can be created quickly, and then turned off for normal use.</p></dd><dt class="dt-description"><span style="font-weight:bold">fat </span></dt><dd class="dd-description">
When this is set to <span style="font-family:monospace">true</span>, Unison will use appropriate options to synchronize efficiently and without error a replica located on a FAT filesystem on a non-Windows machine: do not synchronize permissions (<span style="font-family:monospace">perms = 0</span>); never use chmod (<span style="font-family:monospace">dontchmod = true</span>); treat filenames as case insensitive (<span style="font-family:monospace">ignorecase = true</span>); do not attempt to synchronize symbolic links (<span style="font-family:monospace">links = false</span>); ignore inode number changes when detecting updates (<span style="font-family:monospace">ignoreinodenumbers = true</span>). Any of these change can be overridden by explicitly setting the corresponding preference in the profile.</dd><dt class="dt-description"><span style="font-weight:bold">follow <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-follow </span><span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> causes Unison to treat symbolic links matching <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> as ‘invisible’ and behave as if the object pointed to by the link had appeared literally at this position in the replica. See the <a href="#symlinks">Symbolic Links</a> section for more details. The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is described in the <a href="#pathspec">Path Specification</a> section.</dd><dt class="dt-description"><span style="font-weight:bold">force <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-force </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> causes Unison to resolve all differences (even non-conflicting changes) in favor of <span style="font-family:monospace"><span style="font-style:italic">root</span></span>. This effectively changes Unison from a synchronizer into a mirroring utility. <p>You can also specify a unique prefix or suffix of the path of one of the roots or a unique prefix of the hostname of a remote root.</p><p>You can also specify <code class="verb">-force newer</code> (or <code class="verb">-force older</code>) to force Unison to choose the file with the later (earlier) modtime. In this case, the <code class="verb">-times</code> preference must also be enabled.</p><p>This preference is overridden by the <code class="verb">forcepartial</code> preference.</p><p>This preference should be used only if you are <em>sure</em> you know what you are doing!</p></dd><dt class="dt-description"><span style="font-weight:bold">forcepartial <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">forcepartial = </span><span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span><span style="font-family:monospace"> -&gt; </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> causes Unison to resolve all differences (even non-conflicting changes) in favor of <span style="font-family:monospace"><span style="font-style:italic">root</span></span> for the files in <span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span> (see the <a href="#pathspec">Path Specification</a> section for more information). This effectively changes Unison from a synchronizer into a mirroring utility. <p>You can also specify a unique prefix or suffix of the path of one of the roots or a unique prefix of the hostname of a remote root.</p><p>You can also specify <code class="verb">forcepartial PATHSPEC -&gt; newer</code> (or <code class="verb">forcepartial PATHSPEC -&gt; older</code>) to force Unison to choose the file with the later (earlier) modtime. In this case, the <code class="verb">-times</code> preference must also be enabled.</p><p>This preference should be used only if you are <em>sure</em> you know what you are doing!</p></dd><dt class="dt-description"><span style="font-weight:bold">group </span></dt><dd class="dd-description">
When this flag is set to <code class="verb">true</code>, the group attributes of the files are synchronized. Whether the group names or the group identifiers are synchronized depends on the preference <span style="font-family:monospace">numerids</span>.</dd><dt class="dt-description"><span style="font-weight:bold">halfduplex </span></dt><dd class="dd-description">
<em>(Deprecated)</em> When this flag is set to <span style="font-family:monospace">true</span>, Unison network communication is forced to be half duplex (the client and the server never simultaneously emit data). If you experience unstabilities with your network link, this may help.</dd><dt class="dt-description"><span style="font-weight:bold">height <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
Used to set the height (in lines) of the main window in the graphical user interface.</dd><dt class="dt-description"><span style="font-weight:bold">i </span></dt><dd class="dd-description">
Provide this preference in the command line arguments to enable interactive profile manager in the text user interface. Currently only profile listing and interactive selection are available. Preferences like <span style="font-family:monospace">batch</span> and <span style="font-family:monospace">silent</span> remain applicable to synchronization functionality.</dd><dt class="dt-description"><span style="font-weight:bold">ignore <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-ignore </span><span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> causes Unison to completely ignore paths that match <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> (as well as their children). This is useful for avoiding synchronizing temporary files, object files, etc. The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is described in the <a href="#pathspec">Path Specification</a> section, and further details on ignoring paths is found in the <a href="#ignore">Ignoring Paths</a> section.</dd><dt class="dt-description"><span style="font-weight:bold">ignorearchives </span></dt><dd class="dd-description">
When this preference is set, Unison will ignore any existing archive files and behave as though it were being run for the first time on these replicas. It is not a good idea to set this option in a profile: it is intended for command-line use.</dd><dt class="dt-description"><span style="font-weight:bold">ignorecase <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes Unison to treat filenames as case insensitive—i.e., files in the two replicas whose names differ in (upper- and lower-case) ‘spelling’ are treated as the same file. When the flag is set to <span style="font-family:monospace">false</span>, Unison will treat all filenames as case sensitive. Ordinarily, when the flag is set to <span style="font-family:monospace">default</span>, filenames are automatically taken to be case-insensitive if either host is running Windows or OSX. In rare circumstances it may be useful to set the flag manually.</dd><dt class="dt-description"><span style="font-weight:bold">ignoreinodenumbers </span></dt><dd class="dd-description">
When set to true, this preference makes Unison not take advantage of inode numbers during fast update detection. This switch should be used with care, as it is less safe than the standard update detection method, but it can be useful with filesystems which do not support inode numbers.</dd><dt class="dt-description"><span style="font-weight:bold">ignorelocks </span></dt><dd class="dd-description">
When this preference is set, Unison will ignore any lock files that may have been left over from a previous run of Unison that was interrupted while reading or writing archive files; by default, when Unison sees these lock files it will stop and request manual intervention. This option should be set only if you are <em>positive</em> that no other instance of Unison might be concurrently accessing the same archive files (e.g., because there was only one instance of unison running and it has just crashed or you have just killed it). It is probably not a good idea to set this option in a profile: it is intended for command-line use.</dd><dt class="dt-description"><span style="font-weight:bold">ignorenot <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference overrides the preference <span style="font-family:monospace">ignore</span>.
It gives a list of patterns
(in the same format as
<code class="verb">ignore</code>) for paths that should definitely <em>not</em> be ignored,
whether or not they happen to match one of the <code class="verb">ignore</code> patterns.
<p>Note that the semantics of <span style="font-family:monospace">ignore</span> and <span style="font-family:monospace">ignorenot</span> is a
little counter-intuitive. When detecting updates, Unison examines
paths in depth-first order, starting from the roots of the replicas
and working downwards. Before examining each path, it checks whether
it matches <span style="font-family:monospace">ignore</span> and does not match <span style="font-family:monospace">ignorenot</span>; in this case
it skips this path <em>and all its descendants</em>. This means that,
if some parent of a given path matches an <span style="font-family:monospace">ignore</span> pattern, then
it will be skipped even if the path itself matches an <span style="font-family:monospace">ignorenot</span>
pattern. In particular, putting <span style="font-family:monospace">ignore = Path *</span> in your profile
and then using <span style="font-family:monospace">ignorenot</span> to select particular paths to be
synchronized will not work. Instead, you should use the <span style="font-family:monospace">path</span>
preference to choose particular paths to synchronize.</p></dd><dt class="dt-description"><span style="font-weight:bold">immutable <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference specifies paths for directories whose immediate children are all immutable files — i.e., once a file has been created, its contents never changes. When scanning for updates, Unison does not check whether these files have been modified; this can speed update detection significantly (in particular, for mail directories).</dd><dt class="dt-description"><span style="font-weight:bold">immutablenot <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference overrides <span style="font-family:monospace">immutable</span>.</dd><dt class="dt-description"><span style="font-weight:bold">include <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Include preferences from a profile. <span style="font-family:monospace">include </span><span style="font-family:monospace"><span style="font-style:italic">name</span></span> reads the profile <span style="font-size:large"><span style="font-family:monospace">name</span></span> (or file <span style="font-size:large"><span style="font-family:monospace">name</span></span> in the <span style="font-family:monospace">.unison</span> directory if profile <span style="font-size:large"><span style="font-family:monospace">name</span></span> does not exist) and includes its contents as if it was part of a profile or given directly on command line.</dd><dt class="dt-description"><span style="font-weight:bold">key <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Used in a profile to define a numeric key (0-9) that can be used in the user interface to switch immediately to this profile.</dd><dt class="dt-description"><span style="font-weight:bold">killserver </span></dt><dd class="dd-description">
When set to <code class="verb">true</code>, this flag causes Unison to kill the remote server process when the synchronization is finished. This behavior is the default for <code class="verb">ssh</code> connections, so this preference is not normally needed when running over <code class="verb">ssh</code>; it is provided so that socket-mode servers can be killed off after a single run of Unison, rather than waiting to accept future connections. (Some users prefer to start a remote socket server for each run of Unison, rather than leaving one running all the time.)</dd><dt class="dt-description"><span style="font-weight:bold">label <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Used in a profile to provide a descriptive string documenting its settings. (This is useful for users that switch between several profiles, especially using the ‘fast switch’ feature of the graphical user interface.)</dd><dt class="dt-description"><span style="font-weight:bold">links <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes Unison to synchronize symbolic links. When the flag is set to <span style="font-family:monospace">false</span>, symbolic links will be ignored during update detection. Ordinarily, when the flag is set to <span style="font-family:monospace">default</span>, symbolic links are synchronized except when one of the hosts is running Windows. On a Windows client, Unison makes an attempt to detect if symbolic links are supported and allowed by user privileges. You may have to get elevated privileges to create symbolic links. When the flag is set to default and symbolic links can’t be synchronized then an error is produced during update detection.</dd><dt class="dt-description"><span style="font-weight:bold">listen <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When acting as a server on a TCP socket, Unison will by default listen on "any" address (0.0.0.0 and [::]). This command-line argument allows to specify a different listening address and can be repeated to listen on multiple addresses. Listening address can be specified as a host name or an IP address.</dd><dt class="dt-description"><span style="font-weight:bold">log </span></dt><dd class="dd-description">
When this flag is set, Unison will log all changes to the filesystems
on a file.</dd><dt class="dt-description"><span style="font-weight:bold">logfile <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
By default, logging messages will be appended to the file
<code class="verb">unison.log</code> in your .unison directory. Set this preference if
you prefer another file. It can be a path relative to your .unison directory.
Sending SIGUSR1 will close the logfile; the logfile will be re-opened (and
created, if needed) automatically, to allow for log rotation.</dd><dt class="dt-description"><span style="font-weight:bold">maxbackups <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
This preference specifies the number of backup versions that will be kept by unison, for each path that matches the predicate <code class="verb">backup</code>. The default is 2.</dd><dt class="dt-description"><span style="font-weight:bold">maxerrors <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
This preference controls after how many errors Unison aborts a directory transfer. Setting it to a large number allows Unison to transfer most of a directory even when some files fail to be copied. The default is 1. If the preference is set too high, Unison may take a long time to abort in case of repeated failures (for instance, when the disk is full).</dd><dt class="dt-description"><span style="font-weight:bold">maxsizethreshold <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
A number indicating above what filesize (in kilobytes) Unison should flag a conflict instead of transferring the file. This conflict remains even in the presence of force or prefer options. A negative number will allow every transfer independently of the size. The default is -1. </dd><dt class="dt-description"><span style="font-weight:bold">maxthreads <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
This preference controls how much concurrency is allowed during the transport phase. Normally, it should be set reasonably high to maximize performance, but when Unison is used over a low-bandwidth link it may be helpful to set it lower (e.g. to 1) so that Unison doesn’t soak up all the available bandwidth. The default is the special value 0, which mean 20 threads when file content streaming is deactivated and 1000 threads when it is activated.</dd><dt class="dt-description"><span style="font-weight:bold">merge <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference can be used to run a merge program which will create a new version for each of the files and the backup, with the last backup and both replicas. The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec -&gt; cmd</span></span> is described in the <a href="#pathspec">Path Specification</a> section, and further details on Merging functions are present in the <a href="#merge">Merging Conflicting Versions</a> section.</dd><dt class="dt-description"><span style="font-weight:bold">mountpoint <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-mountpoint PATH</span> causes Unison to double-check, at the end of update detection, that <span style="font-family:monospace">PATH</span> exists and abort if it does not. This is useful when Unison is used to synchronize removable media. This preference can be given more than once. See the <a href="#mountpoints">Mount Points and Removable Media</a> section.</dd><dt class="dt-description"><span style="font-weight:bold">nocreation <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-nocreation </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file creation on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span>.<p>You can also specify a unique prefix or suffix of the path of one of the roots or a unique prefix of the hostname of a remote root.</p><p>This preference can be included twice, once for each root, if you want to prevent any creation.</p></dd><dt class="dt-description"><span style="font-weight:bold">nocreationpartial <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">nocreationpartial = </span><span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span><span style="font-family:monospace"> -&gt; </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file creation in <span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span> on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span> (see the <a href="#pathspec">Path Specification</a> section for more information). It is recommended to use <span style="font-family:monospace">BelowPath</span> patterns when selecting a directory and all its contents.</dd><dt class="dt-description"><span style="font-weight:bold">nodeletion <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-nodeletion </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file deletion on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span>.<p>You can also specify a unique prefix or suffix of the path of one of the roots or a unique prefix of the hostname of a remote root.</p><p>This preference can be included twice, once for each root, if you want to prevent any deletion.</p></dd><dt class="dt-description"><span style="font-weight:bold">nodeletionpartial <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">nodeletionpartial = </span><span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span><span style="font-family:monospace"> -&gt; </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file deletion in <span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span> on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span> (see the <a href="#pathspec">Path Specification</a> section for more information). It is recommended to use <span style="font-family:monospace">BelowPath</span> patterns when selecting a directory and all its contents.</dd><dt class="dt-description"><span style="font-weight:bold">noupdate <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-noupdate </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file update or deletion on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span>.<p>You can also specify a unique prefix or suffix of the path of one of the roots or a unique prefix of the hostname of a remote root.</p><p>This preference can be included twice, once for each root, if you want to prevent any update.</p></dd><dt class="dt-description"><span style="font-weight:bold">noupdatepartial <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">noupdatepartial = </span><span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span><span style="font-family:monospace"> -&gt; </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> prevents Unison from performing any file update or deletion in <span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span> on root <span style="font-family:monospace"><span style="font-style:italic">root</span></span> (see the <a href="#pathspec">Path Specification</a> section for more information). It is recommended to use <span style="font-family:monospace">BelowPath</span> patterns when selecting a directory and all its contents.</dd><dt class="dt-description"><span style="font-weight:bold">numericids </span></dt><dd class="dd-description">
When this flag is set to <code class="verb">true</code>, groups and users are synchronized numerically, rather than by name. <p>The special uid 0 and the special group 0 are never mapped via user/group names even if this preference is not set.</p></dd><dt class="dt-description"><span style="font-weight:bold">owner </span></dt><dd class="dd-description">
When this flag is set to <code class="verb">true</code>, the owner attributes of the files are synchronized. Whether the owner names or the owner identifiers are synchronizeddepends on the preference <span style="font-family:monospace">numerids</span>.</dd><dt class="dt-description"><span style="font-weight:bold">path <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When no <code class="verb">path</code> preference is given, Unison will simply synchronize the two entire replicas, beginning from the given pair of roots. If one or more <code class="verb">path</code> preferences are given, then Unison will synchronize only these paths and their children. (This is useful for doing a fast sync of just one directory, for example.) Note that <span style="font-family:monospace">path</span> preferences are interpreted literally—they are not regular expressions.</dd><dt class="dt-description"><span style="font-weight:bold">perms <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
The integer value of this preference is a mask indicating which permission bits should be synchronized. It is set by default to 0<span style="font-style:italic">o</span>1777: all bits but the set-uid and set-gid bits are synchronised (synchronizing these latter bits can be a security hazard). If you want to synchronize all bits, you can set the value of this preference to −1. If one of the replica is on a FAT [Windows] filesystem, you should consider using the <span style="font-family:monospace">fat</span> preference instead of this preference. If you need Unison not to set permissions at all, set the value of this preference to 0 and set the preference <span style="font-family:monospace">dontchmod</span> to <span style="font-family:monospace">true</span>.</dd><dt class="dt-description"><span style="font-weight:bold">prefer <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">-prefer </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> causes Unison always to resolve conflicts in favor of <span style="font-family:monospace"><span style="font-style:italic">root</span></span>, rather than asking for guidance from the user, except for paths marked by the preference <span style="font-family:monospace">merge</span>. (The syntax of <span style="font-family:monospace"><span style="font-style:italic">root</span></span> is the same as for the <code class="verb">root</code> preference, plus the special values <code class="verb">newer</code> and <code class="verb">older</code>.) <p>You can also specify a unique prefix or suffix of the path of one of the roots or a unique prefix of the hostname of a remote root.</p><p>This preference is overridden by the <code class="verb">preferpartial</code> preference.</p><p>This preference should be used only if you are <em>sure</em> you know what you are doing!</p></dd><dt class="dt-description"><span style="font-weight:bold">preferpartial <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Including the preference <span style="font-family:monospace">preferpartial = </span><span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span><span style="font-family:monospace"> -&gt; </span><span style="font-family:monospace"><span style="font-style:italic">root</span></span> causes Unison always to resolve conflicts in favor of <span style="font-family:monospace"><span style="font-style:italic">root</span></span>, rather than asking for guidance from the user, for the files in <span style="font-family:monospace"><span style="font-style:italic">PATHSPEC</span></span> (see the <a href="#pathspec">Path Specification</a> section for more information). (The syntax of <span style="font-family:monospace"><span style="font-style:italic">root</span></span> is the same as for the <code class="verb">root</code> preference, plus the special values <code class="verb">newer</code> and <code class="verb">older</code>.) <p>You can also specify a unique prefix or suffix of the path of one of the roots or a unique prefix of the hostname of a remote root.</p><p>This preference should be used only if you are <em>sure</em> you know what you are doing!</p></dd><dt class="dt-description"><span style="font-weight:bold">repeat <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Setting this preference causes the text-mode interface to synchronize repeatedly, rather than doing it just once and stopping. If the argument is a number, Unison will pause for that many seconds before beginning again. When the argument is <code class="verb">watch</code>, Unison relies on an external file monitoring process to synchronize whenever a change happens. You can combine the two with a <code class="verb">+</code> character to use file monitoring and also do a full scan every specificed number of seconds. For example, <code class="verb">watch+3600</code> will react to changes immediately and additionally do a full scan every hour.</dd><dt class="dt-description"><span style="font-weight:bold">retry <span style="font-family:monospace">n</span></span></dt><dd class="dd-description">
Setting this preference causes the text-mode interface to try again to synchronize updated paths where synchronization fails. Each such path will be tried N times.</dd><dt class="dt-description"><span style="font-weight:bold">root <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Each use of this preference names the root of one of the replicas for Unison to synchronize. Exactly two roots are needed, so normal modes of usage are either to give two values for <code class="verb">root</code> in the profile, or to give no values in the profile and provide two on the command line. Details of the syntax of roots can be found in the <a href="#roots">Roots</a> section.<p>The two roots can be given in either order; Unison will sort them into a canonical order before doing anything else. It also tries to ‘canonize’ the machine names and paths that appear in the roots, so that, if Unison is invoked later with a slightly different name for the same root, it will be able to locate the correct archives.</p></dd><dt class="dt-description"><span style="font-weight:bold">rootalias <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When calculating the name of the archive files for a given pair of roots, Unison replaces any roots matching the left-hand side of any rootalias rule by the corresponding right-hand side.</dd><dt class="dt-description"><span style="font-weight:bold">rsrc <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes Unison to synchronize resource forks and HFS meta-data. On filesystems that do not natively support resource forks, this data is stored in Carbon-compatible ._ AppleDouble files. When the flag is set to <span style="font-family:monospace">false</span>, Unison will not synchronize these data. Ordinarily, the flag is set to <span style="font-family:monospace">default</span>, and these data are
automatically synchronized if either host is running OSX. In rare circumstances it is useful to set the flag manually.</dd><dt class="dt-description"><span style="font-weight:bold">rsync </span></dt><dd class="dd-description">
Unison uses the ’rsync algorithm’ for ’diffs-only’ transfer of updates to large files. Setting this flag to false makes Unison use whole-file transfers instead. Under normal circumstances, there is no reason to do this, but if you are having trouble with repeated ’rsync failure’ errors, setting it to false should permit you to synchronize the offending files.</dd><dt class="dt-description"><span style="font-weight:bold">selftest </span></dt><dd class="dd-description">
Run internal tests and exit. This option is mostly for developers and must be used carefully: in particular, it will delete the contents of both roots, so that it can install its own files for testing. This flag only makes sense on the command line. When it is provided, no preference file is read: all preferences must be specified on thecommand line. Also, since the self-test procedure involves overwriting the roots and backup directory, the names of the roots and of the backupdir preference must include the string "test" or else the tests will be aborted. (If these are not given on the command line, dummy subdirectories in the current directory will be created automatically.)</dd><dt class="dt-description"><span style="font-weight:bold">servercmd <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference can be used to explicitly set the name of the Unison executable on the remote server (e.g., giving a full path name), if necessary.</dd><dt class="dt-description"><span style="font-weight:bold">showarchive </span></dt><dd class="dd-description">
When this preference is set, Unison will print out the ’true names’of the roots, in the same form as is expected by the <span style="font-family:monospace">rootalias</span> preference.</dd><dt class="dt-description"><span style="font-weight:bold">silent </span></dt><dd class="dd-description">
When this preference is set to <span style="font-family:monospace">true</span>, the textual user interface will print nothing at all, except in the case of errors. Setting <span style="font-family:monospace">silent</span> to true automatically sets the <span style="font-family:monospace">batch</span> preference to <span style="font-family:monospace">true</span>.</dd><dt class="dt-description"><span style="font-weight:bold">socket <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Start unison as a server listening on a TCP socket (with TCP port number as argument) or a local socket (aka Unix domain socket) (with socket path as argument).</dd><dt class="dt-description"><span style="font-weight:bold">sortbysize </span></dt><dd class="dd-description">
When this flag is set, the user interface will list changed files by size (smallest first) rather than by name. This is useful, for example, for synchronizing over slow links, since it puts very large files at the end of the list where they will not prevent smaller files from being transferred quickly.<p>This preference (as well as the other sorting flags, but not the sorting preferences that require patterns as arguments) can be set interactively and temporarily using the ’Sort’ menu in the graphical and text user interfaces.</p></dd><dt class="dt-description"><span style="font-weight:bold">sortfirst <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Each argument to <span style="font-family:monospace">sortfirst</span> is a pattern <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span>, which describes a set of paths. Files matching any of these patterns will be listed first in the user interface. The syntax of <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is described in the <a href="#pathspec">Path Specification</a> section.</dd><dt class="dt-description"><span style="font-weight:bold">sortlast <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Similar to <code class="verb">sortfirst</code>, except that files matching one of these patterns will be listed at the very end.</dd><dt class="dt-description"><span style="font-weight:bold">sortnewfirst </span></dt><dd class="dd-description">
When this flag is set, the user interface will list newly created files before all others. This is useful, for example, for checking that newly created files are not ‘junk’, i.e., ones that should be ignored or deleted rather than synchronized.</dd><dt class="dt-description"><span style="font-weight:bold">source <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Include preferences from a file. <span style="font-family:monospace">source </span><span style="font-family:monospace"><span style="font-style:italic">name</span></span> reads the file <span style="font-size:large"><span style="font-family:monospace">name</span></span> in the <span style="font-family:monospace">.unison</span> directory and includes its contents as if it was part of a profile or given directly on command line.</dd><dt class="dt-description"><span style="font-weight:bold">sshargs <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
The string value of this preference will be passed as additional arguments (besides the host name and the name of the Unison executable on the remote system) to the <code class="verb">ssh</code> command used to invoke the remote server. The backslash is an escape character.</dd><dt class="dt-description"><span style="font-weight:bold">sshcmd <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference can be used to explicitly set the name of the ssh executable (e.g., giving a full path name), if necessary.</dd><dt class="dt-description"><span style="font-weight:bold">stream </span></dt><dd class="dd-description">
<em>(Deprecated)</em> When this preference is set, Unison will use an experimental streaming protocol for transferring file contents more efficiently. The default value is <span style="font-family:monospace">true</span>.</dd><dt class="dt-description"><span style="font-weight:bold">terse </span></dt><dd class="dd-description">
When this preference is set to <span style="font-family:monospace">true</span>, the user interface will not print status messages.</dd><dt class="dt-description"><span style="font-weight:bold">testserver </span></dt><dd class="dd-description">
Setting this flag on the command line causes Unison to attempt to connect to the remote server and, if successful, print a message and immediately exit. Useful for debugging installation problems. Should not be set in preference files.</dd><dt class="dt-description"><span style="font-weight:bold">times </span></dt><dd class="dd-description">
When this flag is set to <code class="verb">true</code>, file modification times (but not directory modtimes) are propagated.</dd><dt class="dt-description"><span style="font-weight:bold">ui <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference selects either the graphical or the textual user interface. Legal values are <code class="verb">graphic</code> or <code class="verb">text</code>. <p>Because this option is processed specially during Unison’s start-up sequence, it can <em>only</em> be used on the command line. In preference files it has no effect.</p><p>If the Unison executable was compiled with only a textual interface, this option has no effect. (The pre-compiled binaries are all compiled with both interfaces available.)</p></dd><dt class="dt-description"><span style="font-weight:bold">unicode <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
When set to <span style="font-family:monospace">true</span>, this flag causes Unison to perform case insensitive file comparisons assuming Unicode encoding. This is the default. When the flag is set to <span style="font-family:monospace">false</span>, Latin 1 encoding is assumed (this means that all bytes that are not letters in Latin 1 encoding will be compared byte-for-byte, even if they may be valid characters in some other encoding). When Unison runs in case sensitive mode, this flag only makes a difference if one host is running Mac OS X. Under Mac OS X, it selects whether comparing the filenames up to decomposition, or byte-for-byte.</dd><dt class="dt-description"><span style="font-weight:bold">version </span></dt><dd class="dd-description">
Print the current version number and exit. (This option only makes sense on the command line.)</dd><dt class="dt-description"><span style="font-weight:bold">watch </span></dt><dd class="dd-description">
Unison uses a file watcher process, when available, to detect filesystem changes; this is used to speed up update detection. Setting this flag to false disables the use of this process.</dd><dt class="dt-description"><span style="font-weight:bold">xattrignore <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
Preference <span style="font-family:monospace">-xattrignore </span><span style="font-family:monospace"><span style="font-style:italic">namespec</span></span> causes Unison to ignore extended attributes with names that match <span style="font-family:monospace"><span style="font-style:italic">namespec</span></span>. This can be used to exclude extended attributes that would fail synchronization due to lack of permissions or technical differences at replicas. The syntax of <span style="font-family:monospace"><span style="font-style:italic">namespec</span></span> is the same as used for path specification (described in the <a href="#pathspec">Path Specification</a> section); prefer the <code class="verb">Path</code> and <code class="verb">Regex</code> forms over the <code class="verb">Name</code> form. The pattern is applied to the <em>name</em> of extended attribute, not to path. <em>On Linux</em>, attributes in the security and trusted namespaces are ignored by default (this is achieved by pattern <span style="font-family:monospace">Regex !(security|trusted)[.].*</span>); also attributes used to store POSIX ACL are ignored by default (this is achieved by pattern <span style="font-family:monospace">Path !system.posix_acl_*</span>). To sync attributes in one or both of these namespaces, see the <code class="verb">xattrignorenot</code> preference. Note that the namespace name must be prefixed with a "!" (applies on Linux only). All names not prefixed with a "!" are taken as strictly belonging to the user namespace and therefore the "!user." prefix is never used.</dd><dt class="dt-description"><span style="font-weight:bold">xattrignorenot <span style="font-family:monospace">xxx</span></span></dt><dd class="dd-description">
This preference overrides the preference <span style="font-family:monospace">xattrignore</span>. It gives a list of patterns (in the same format as <code class="verb">xattrignore</code>) for extended attributes that should <em>not</em> be ignored, whether or not they happen to match one of the <code class="verb">xattrignore</code> patterns. It is possible to synchronize only desired attributes by ignoring all attributes (for example, by setting <code class="verb">xattrignore</code> to <span style="font-family:monospace">Path *</span> and then adding <code class="verb">xattrignorenot</code> for extended attributes that should be synchronized. <em>On Linux</em>, attributes in the security and trusted namespaces are ignored by default. To sync attributes in one or both of these namespaces, you may add an <code class="verb">xattrignorenot</code> pattern like <span style="font-family:monospace">Path !security.*</span> to sync all attributes in the security namespace, or <span style="font-family:monospace">Path !security.selinux</span> to sync a specific attribute in an otherwise ignored namespace. A pattern like <span style="font-family:monospace">Path !system.posix_acl_*</span> can be used to sync POSIX ACLs on Linux. Note that the namespace name must be prefixed with a "!" (applies on Linux only). All names not prefixed with a "!" are taken as strictly belonging to the user namespace and therefore the "!user." prefix is never used.</dd><dt class="dt-description"><span style="font-weight:bold">xattrs </span></dt><dd class="dd-description">
When this flag is set to <code class="verb">true</code>, the extended attributes of files and directories are synchronized. System extended attributes are not synchronized.</dd><dt class="dt-description"><span style="font-weight:bold">xferbycopying </span></dt><dd class="dd-description">
When this preference is set, Unison will try to avoid transferring file contents across the network by recognizing when a file with the required contents already exists in the target replica. This usually allows file moves to be propagated very quickly. The default value is <span style="font-family:monospace">true</span>. </dd></dl><!--TOC subsection id="sec39" Profiles-->
<h3 id="sec39" class="subsection"><a id="profile">Profiles</a></h3><!--SEC END --><p>A <em>profile</em> is a text file that specifies permanent settings for
roots, paths, ignore patterns, and other preferences, so that they do
not need to be typed at the command line every time Unison is run.
Profiles should reside in the <code class="verb">.unison</code> directory on the client
machine. If Unison is started with just one argument <span style="font-family:monospace"><span style="font-style:italic">name</span></span> on
the command line, it looks for a profile called <span style="font-family:monospace"><span style="font-style:italic">name</span></span><span style="font-family:monospace">.prf</span> in
the <code class="verb">.unison</code> directory. If it is started with no arguments, it
scans the <code class="verb">.unison</code> directory for files whose names end in
<code class="verb">.prf</code> and offers a menu (provided that the Unison executable is compiled with the graphical user interface). If a file named <code class="verb">default.prf</code> is
found, its settings will be offered as the default choices.</p><p>To set the value of a preference <span style="font-family:monospace">p</span> permanently, add to the
appropriate profile a line of the form
</p><pre class="verbatim">        p = true
</pre><p>
for a boolean flag or
</p><pre class="verbatim">        p = &lt;value&gt;
</pre><p>
for a preference of any other type.</p><p>A profile may include blank lines and lines beginning
with <span style="font-family:monospace">#</span>; both are ignored.</p><p>Spaces and tabs before and after <span style="font-family:monospace">p</span> and <span style="font-family:monospace">xxx</span> are ignored.
Spaces, tabs, and non-printable characters within values are not
treated specially, so that e.g. <code class="verb">root = /foo bar</code> refers to a
directory containing a space.
(On systems using newline for line ending, carriage returns are
currently ignored, but this is not part of the specification.)</p><p>When Unison starts, it first reads the profile and then the command
line, so command-line options will override settings from the
profile.</p><p>Profiles may also include lines of the form <span style="font-family:monospace">include </span><span style="font-family:monospace"><span style="font-style:italic">name</span></span>,
which will cause the file <span style="font-family:monospace"><span style="font-style:italic">name</span></span> (or <span style="font-family:monospace"><span style="font-style:italic">name</span></span><span style="font-family:monospace">.prf</span>, if
<span style="font-family:monospace"><span style="font-style:italic">name</span></span> does not exist in the <code class="verb">.unison</code> directory) to be read at
the point, and included as if its contents, instead of the <span style="font-family:monospace">include</span>
line, was part of the profile. Include lines allows settings common to
several profiles to be stored in one place.
A similar line of the form <span style="font-family:monospace">source </span><span style="font-family:monospace"><span style="font-style:italic">name</span></span> does the same except
that it does not attempt to add a suffix to <span style="font-family:monospace"><span style="font-style:italic">name</span></span>.
Similar lines of the form <span style="font-family:monospace">include</span><span style="font-family:monospace">?</span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">name</span></span> or
<span style="font-family:monospace">source</span><span style="font-family:monospace">?</span><span style="font-family:monospace"> </span><span style="font-family:monospace"><span style="font-style:italic">name</span></span> do the same as their respective lines
without the question mark except that it does not constitute an error to
specify a non-existing file <span style="font-family:monospace"><span style="font-style:italic">name</span></span>.
In <span style="font-family:monospace"><span style="font-style:italic">name</span></span> the backslash is an escape character.</p><p>A profile may include a preference ‘<span style="font-family:monospace">label = </span><span style="font-family:monospace"><span style="font-style:italic">desc</span></span>’ to
provide a description of the options selected in this profile. The
string <span style="font-family:monospace"><span style="font-style:italic">desc</span></span> is listed along with the profile name in the profile
selection dialog, and displayed in the top-right corner of the main
Unison window in the graphical user interface.</p><p>The graphical user-interface also supports one-key shortcuts for commonly
used profiles. If a profile contains a preference of the form
‘<span style="font-family:monospace">key = </span><span style="font-family:monospace"><span style="font-style:italic">n</span></span>’, where <span style="font-family:monospace"><span style="font-style:italic">n</span></span> is a single digit, then
pressing this digit key will cause Unison to immediately switch to
this profile and begin synchronization again from scratch. In this
case, all actions that have been selected for a set of changes
currently being displayed will be discarded.</p><!--TOC subsection id="sec40" Sample Profiles-->
<h3 id="sec40" class="subsection"><a id="profileegs">Sample Profiles</a></h3><!--SEC END --><!--TOC subsubsection id="sec41" A Minimal Profile-->
<h4 id="sec41" class="subsubsection"><a id="minimalprofile">A Minimal Profile</a></h4><!--SEC END --><p>Here is a very minimal profile file, such as might be found in <span style="font-family:monospace">.unison/default.prf</span>:
</p><pre class="verbatim">    # Roots of the synchronization
    root = /home/bcpierce
    root = ssh://saul//home/bcpierce

    # Paths to synchronize
    path = current
    path = common
    path = .netscape/bookmarks.html
</pre><!--TOC subsubsection id="sec42" A Basic Profile-->
<h4 id="sec42" class="subsubsection"><a id="basicprofile">A Basic Profile</a></h4><!--SEC END --><p>Here is a more sophisticated profile, illustrating some other useful
features.
</p><pre class="verbatim">    # Roots of the synchronization
    root = /home/bcpierce
    root = ssh://saul//home/bcpierce

    # Paths to synchronize
    path = current
    path = common
    path = .netscape/bookmarks.html

    # Some regexps specifying names and paths to ignore
    ignore = Name temp.*
    ignore = Name *~
    ignore = Name .*~
    ignore = Path */pilot/backup/Archive_*
    ignore = Name *.o
    ignore = Name *.tmp

    # Window height
    height = 37

    # Keep a backup copy of every file in a central location
    backuplocation = central
    backupdir = /home/bcpierce/backups
    backup = Name *
    backupprefix = $VERSION.
    backupsuffix =

    # Use this command for displaying diffs
    diff = diff -y -W 79 --suppress-common-lines

    # Log actions to the terminal
    log = true
</pre><!--TOC subsubsection id="sec43" A Power-User Profile-->
<h4 id="sec43" class="subsubsection"><a id="powerprofile">A Power-User Profile</a></h4><!--SEC END --><p>When Unison is used with large replicas, it is often convenient to be
able to synchronize just a part of the replicas on a given run (this
saves the time of detecting updates in the other parts). This can be
accomplished by splitting up the profile into several parts — a common
part containing most of the preference settings, plus one “top-level”
file for each set of paths that need to be synchronized. (The <span style="font-family:monospace">include</span> mechanism can also be used to allow the same set of preference
settings to be used with different roots.)</p><p>The collection
of profiles implementing this scheme might look as follows.
The file <span style="font-family:monospace">default.prf</span> is empty except for an <span style="font-family:monospace">include</span>
directive:
</p><pre class="verbatim">    # Include the contents of the file common
    include common
</pre><p>
Note that the name of the common file is <span style="font-family:monospace">common</span>, not <span style="font-family:monospace">common.prf</span>; this prevents Unison from offering <span style="font-family:monospace">common</span> as one of
the list of profiles in the opening dialog (in the graphical UI).</p><p>The file <span style="font-family:monospace">common</span> contains the real preferences:
</p><pre class="verbatim">    # Roots of the synchronization
    root = /home/bcpierce
    root = ssh://saul//home/bcpierce

    # (... other preferences ...)

    # If any new preferences are added by Unison (e.g. 'ignore'
    # preferences added via the graphical UI), then store them in the
    # file 'common' rather than in the top-level preference file
    addprefsto = common

    # Names and paths to ignore:
    ignore = Name temp.*
    ignore = Name *~
    ignore = Name .*~
    ignore = Path */pilot/backup/Archive_*
    ignore = Name *.o
    ignore = Name *.tmp
</pre><p>
Note that there are no <span style="font-family:monospace">path</span> preferences in <span style="font-family:monospace">common</span>. This
means that, when we invoke Unison with the default profile (e.g., by
typing ’<span style="font-family:monospace">unison default</span>’ or just ’<span style="font-family:monospace">unison</span>’ on the command
line), the whole replicas will be synchronized. (If we <em>never</em> want
to synchronize the whole replicas, then <span style="font-family:monospace">default.prf</span> would instead
include settings for all the paths that are usually synchronized.)</p><p>To synchronize just part of the replicas, Unison is invoked with an
alternate preference file—e.g., doing ’<span style="font-family:monospace">unison workingset</span>’, where the
preference file <span style="font-family:monospace">workingset.prf</span> contains
</p><pre class="verbatim">    path = current/papers
    path = Mail/inbox
    path = Mail/drafts
    include common
</pre><p>
causes Unison to synchronize just the listed subdirectories.</p><p>The <span style="font-family:monospace">key</span> preference can be used in combination with the graphical UI
to quickly switch between different sets of paths. For example, if the
file <span style="font-family:monospace">mail.prf</span> contains
</p><pre class="verbatim">    path = Mail
    batch = true
    key = 2
    include common
</pre><p>
then pressing 2 will cause Unison to look for updates in the <span style="font-family:monospace">Mail</span>
subdirectory and (because the <span style="font-family:monospace">batch</span> flag is set) immediately
propagate any that it finds.</p><!--TOC subsection id="sec44" Keeping Backups-->
<h3 id="sec44" class="subsection"><a id="backups">Keeping Backups</a></h3><!--SEC END --><p>When Unison overwrites (or deletes) a file or directory while propagating changes from
the other replica, it can keep the old version around as a backup. There
are several preferences that control precisely where these backups are
stored and how they are named.</p><p>To enable backups, you must give one or more <code class="verb">backup</code> preferences.
Each of these has the form
</p><pre class="verbatim">    backup = &lt;pathspec&gt;
</pre><p>
where <code class="verb">&lt;pathspec&gt;</code> has the same form as for the <code class="verb">ignore</code>
preference. For example,
</p><pre class="verbatim">    backup = Name *
</pre><p>
causes Unison to create backups of <em>all</em> files and directories. The
<code class="verb">backupnot</code> preference can be used to give a few exceptions: it
specifies which files and directories should <em>not</em> be backed up, even if
they match the <code class="verb">backup</code> pathspec.</p><p>It is important to note that the <code class="verb">pathspec</code> is matched against the path
that is being updated by Unison, not its descendants. For example, if you
set <code class="verb">backup = Name *.txt</code> and then delete a whole directory named
<code class="verb">foo</code> containing some text files, these files will not be backed up
because Unison will just check that <code class="verb">foo</code> does not match <code class="verb">*.txt</code>.
Similarly, if the directory itself happened to be called <code class="verb">foo.txt</code>,
then the whole directory and all the files in it will be backed up,
regardless of their names.</p><p>Backup files can be stored either <em>centrally</em> or <em>locally</em>. This
behavior is controlled by the preference <code class="verb">backuplocation</code>, whose value
must be either <code class="verb">central</code> or <code class="verb">local</code>. (The default is
<code class="verb">central</code>.) Note that central storage of backups can lead to
backup files being stored in a different filesystem than the original
files, which could have different security properties and different
amounts of available storage.</p><p>When backups are stored locally, they are kept in the same
directory as the original.</p><p>When backups are stored centrally, the directory used to hold them is
controlled by the preference <code class="verb">backupdir</code> and the
environment variable <code class="verb">UNISONBACKUPDIR</code>. (The environment variable is
checked first.) If neither of these are set, then the directory
<code class="verb">.unison/backup</code> in the user’s home directory is used.</p><p>The preference <code class="verb">maxbackups</code> (default 2) controls how many
previous versions of each file are kept (including the current
version), following the usual plan of deleting the oldest when
creating a new one.</p><p>By default, backup files are named <code class="verb">.bak.VERSION.FILENAME</code>,
where <code class="verb">FILENAME</code> is the original filename and <code class="verb">VERSION</code> is the
backup number (1 for the most recent, 2 for the next most recent,
etc.). This can be changed by setting the preferences <code class="verb">backupprefix</code>
and/or <code class="verb">backupsuffix</code>. If desired, <code class="verb">backupprefix</code> may include a
directory prefix; this can be used with <code class="verb">backuplocation = local</code> to put all
backup files for each directory into a single subdirectory. For example, setting
</p><pre class="verbatim">    backuplocation = local
    backupprefix = .unison/$VERSION.
    backupsuffix =
</pre><p>
will put all backups in a local subdirectory named <code class="verb">.unison</code>. Also,
note that the string <code class="verb">$VERSION</code> in either <code class="verb">backupprefix</code> or
<code class="verb">backupsuffix</code> (it must appear in one or the other) is replaced by
the version number. This can be used, for example, to ensure that backup
files retain the same extension as the originals.</p><p>Other than <code class="verb">maxbackups</code> (which will never delete the last
backup), there are no other mechanisms for deleting backups.</p><p>For backward compatibility, the <code class="verb">backups</code> preference is also supported.
It simply means <code class="verb">backup = Name *</code> and <code class="verb">backuplocation = local</code>.</p><!--TOC subsection id="sec45" Merging Conflicting Versions-->
<h3 id="sec45" class="subsection"><a id="merge">Merging Conflicting Versions</a></h3><!--SEC END --><p>Unison can invoke external programs to merge conflicting versions of a file.
The preference <code class="verb">merge</code> controls this process.</p><p>The <code class="verb">merge</code> preference may be given once or several times in a
preference file (it can also be given on the command line, of course, but
this tends to be awkward because of the spaces and special characters
involved). Each instance of the preference looks like this:
</p><pre class="verbatim">    merge = &lt;PATHSPEC&gt; -&gt; &lt;MERGECMD&gt;
</pre><p>
The <code class="verb">&lt;PATHSPEC&gt;</code> here has exactly the same format as for the
<code class="verb">ignore</code> preference (see the <a href="#pathspec">Path Specification</a> section). For example,
using “<code class="verb">Name *.txt</code>” as the <code class="verb">&lt;PATHSPEC&gt;</code> tells Unison that this
command should be used whenever a file with extension <code class="verb">.txt</code> needs to
be merged.</p><p>Many external merging programs require as inputs not just the two files that
need to be merged, but also a file containing the <em>last synchronized
version</em>. You can ask Unison to keep a copy of the last synchronized
version for some files using the <code class="verb">backupcurrent</code> preference. This
preference is used in exactly the same way as <code class="verb">backup</code> and its meaning
is similar, except that it causes backups to be created of the <em>current</em>
contents of each file after it has been synchronized by Unison, rather than
the <em>previous</em> contents that Unison overwrote. These backups are stored
in <em>both</em> replicas in the same place as ordinary backup files—i.e.
according to the <code class="verb">backuplocation</code> and <code class="verb">backupdir</code> preferences.
They are named like the original files if <code class="verb">backupslocation</code> is set to
’central’ and otherwise, Unison uses the <code class="verb">backupprefix</code> and
<code class="verb">backupsuffix</code> preferences and assumes a version number 000 for these
backups. Note that there are no mechanisms (beyond the limit on the number of
backups for each file) to remove backup files.</p><p>The <code class="verb">&lt;MERGECMD&gt;</code> part of the preference specifies what external command
should be invoked to merge files at paths matching the <code class="verb">&lt;PATHSPEC&gt;</code>.
Within this string, several special substrings are recognized; these will be
substituted with appropriate values before invoking a sub-shell to execute
the command.
</p><ul class="itemize"><li class="li-itemize">
<code class="verb">CURRENT1</code> is replaced by the name of (a temporary copy of)
the local variant of the file.
</li><li class="li-itemize"><code class="verb">CURRENT2</code> is replaced by the name of a temporary
file, into which the contents of the remote variant of the file have
been transferred by Unison prior to performing the merge.
</li><li class="li-itemize"><code class="verb">CURRENTARCH</code> is replaced by the name of the backed up copy
of the original version of the file (i.e., the file saved by Unison
if the current filename matches the path specifications for the
<code class="verb">backupcurrent</code> preference, as explained above), if one exists.
If no archive exists and <code class="verb">CURRENTARCH</code> appears in the
merge command, then an error is signalled.
</li><li class="li-itemize"><code class="verb">CURRENTARCHOPT</code> is replaced by the name of the backed up copy
of the original version of the file (i.e., its state at the end of
the last successful run of Unison), if one exists, or the empty
string if no archive exists.
</li><li class="li-itemize"><code class="verb">NEW</code> is replaced by the name of a temporary file
that Unison expects to be written by the merge program when it
finishes, giving the desired new contents of the file.
</li><li class="li-itemize"><code class="verb">PATH</code> is replaced by the path (relative to the roots of
the replicas) of the file being merged.
</li><li class="li-itemize"><code class="verb">NEW1</code> and <code class="verb">NEW2</code> are replaced by the names of temporary files
that Unison expects to be written by the merge program when it
is only able to partially merge the originals; in this case, <code class="verb">NEW1</code>
will be written back to the local replica and <code class="verb">NEW2</code> to the remote
replica; <code class="verb">NEWARCH</code>, if present, will be used as the “last common
state” of the replicas. (These three options are provided for
later compatibility with the Harmony data synchronizer.)
</li><li class="li-itemize"><code class="verb">BATCHMODE</code> is replaced according to the batch mode of
Unison; if it is in <span style="font-family:monospace">batch</span> mode, then a non empty string
(“<code class="verb">batch</code>”) is substituted, otherwise the empty string is substituted.
</li></ul><p>
To accommodate the wide variety of programs that users might want to use for
merging, Unison checks for several possible situations when the merge
program exits:
</p><ul class="itemize"><li class="li-itemize">
If the merge program exits with a non-zero status, then merge is
considered to have failed and the replicas are not changed.
</li><li class="li-itemize">If the file <code class="verb">NEW</code> has been created, it is written back to both
replicas (and stored in the backup directory). Similarly, if just the
file <code class="verb">NEW1</code> has been created, it is written back to both
replicas.
</li><li class="li-itemize">If neither <code class="verb">NEW</code> nor <code class="verb">NEW1</code> have been created, then Unison
examines the temporary files <code class="verb">CURRENT1</code> and <code class="verb">CURRENT2</code> that
were given as inputs to the merge program. If either has been changed (or
both have been changed in identical ways), then its new contents are written
back to both replicas. If either <code class="verb">CURRENT1</code> or <code class="verb">CURRENT2</code> has
been <em>deleted</em>, then the contents of the other are written back to
both replicas.
</li><li class="li-itemize">If the files <code class="verb">NEW1</code>, <code class="verb">NEW2</code>, and <code class="verb">NEWARCH</code> have all
been created, they are written back to the local replica, remote replica,
and backup directory, respectively. If the files <code class="verb">NEW1</code>, <code class="verb">NEW2</code> have
been created, but <code class="verb">NEWARCH</code> has not, then these files are written back to the
local replica and remote replica, respectively. Also, if <code class="verb">NEW1</code> and
<code class="verb">NEW2</code> have identical contents, then the same contents are stored as
a backup (if the <code class="verb">backupcurrent</code> preference is set for this path) to
reflect the fact that the path is currently in sync.
</li><li class="li-itemize">If <code class="verb">NEW1</code> and <code class="verb">NEW2</code> (resp. <code class="verb">CURRENT1</code> and
<code class="verb">CURRENT2</code>) are created (resp. overwritten) with different contents
but the merge command did not fail (i.e., it exited with status code 0),
then we copy <code class="verb">NEW1</code> (resp. <code class="verb">CURRENT1</code>) to the other replica and
to the archive.<p>This behavior is a design choice made to handle the case where a merge
command only synchronizes some specific contents between two files,
skipping some irrelevant information (order between entries, for
instance). We assume that, if the merge command exits normally, then the
two resulting files are “as good as equal.” (The reason we copy one on
top of the other is to avoid Unison detecting that the files are unequal
the next time it is run and trying again to merge them when, in fact, the
merge program has already made them as similar as it is able to.)
</p></li></ul><p>You can disable a merge by setting a <code class="verb">&lt;MERGECMD&gt;</code> that does nothing. For
example you can override the merging of text files specified in a profile by
typing on the command line:
</p><pre class="verbatim">    unison profile -merge 'Name *.txt -&gt; echo SKIP'
</pre><p>If the <code class="verb">confirmmerge</code> preference is set and Unison is not run in
batch mode, then Unison will always ask for confirmation before
actually committing the results of the merge to the replicas.</p><p>You can detect batch mode by testing <code class="verb">BATCHMODE</code>; for
example to avoid a merge completely do nothing:
</p><pre class="verbatim">    merge = Name *.txt -&gt; [ -z "BATCHMODE" ] &amp;&amp; mergecmd CURRENT1 CURRENT2
</pre><p>A large number of external merging programs are available.
For example, on Unix systems setting the <code class="verb">merge</code> preference to
</p><pre class="verbatim">    merge = Name *.txt -&gt; diff3 -m CURRENT1 CURRENTARCH CURRENT2
                            &gt; NEW || echo "differences detected"
</pre><p>
will tell Unison to use the external <code class="verb">diff3</code> program for merging.
Alternatively, users of <code class="verb">emacs</code> may find the following settings convenient:
</p><pre class="verbatim">    merge = Name *.txt -&gt; emacs -q --eval '(ediff-merge-files-with-ancestor
                             "CURRENT1" "CURRENT2" "CURRENTARCH" nil "NEW")'
</pre><p>
(These commands are displayed here on two lines to avoid running off the
edge of the page. In your preference file, each command should be written on a
single line.)</p><p>Users running emacs under windows may find something like this useful:
</p><pre class="verbatim">   merge = Name * -&gt; C:\Progra~1\Emacs\emacs\bin\emacs.exe -q --eval
                            "(ediff-files """CURRENT1""" """CURRENT2""")"
</pre><p>Users running Mac OS X (you may need the Developer Tools installed to get
the <span style="font-family:monospace">opendiff</span> utility) may prefer
</p><pre class="verbatim">    merge = Name *.txt -&gt; opendiff CURRENT1 CURRENT2 -ancestor CURRENTARCH -merge NEW
</pre><p>
Here is a slightly more involved hack. The <span style="font-family:monospace">opendiff</span> program can
operate either with or without an archive file. A merge command of this
form
</p><pre class="verbatim">    merge = Name *.txt -&gt;
              if [ CURRENTARCHOPTx = x ];
              then opendiff CURRENT1 CURRENT2 -merge NEW;
              else opendiff CURRENT1 CURRENT2 -ancestor CURRENTARCHOPT -merge NEW;
              fi
</pre><p>
(still all on one line in the preference file!) will test whether an archive
file exists and use the appropriate variant of the arguments to <span style="font-family:monospace">opendiff</span>.</p><p>Linux users may enjoy this variant:
</p><pre class="verbatim">    merge = Name * -&gt; kdiff3 -o NEW CURRENTARCHOPT CURRENT1 CURRENT2
</pre><p>Ordinarily, external merge programs are only invoked when Unison is <em>not</em> running in batch mode. To specify an external merge program that
should be used no matter the setting of the <span style="font-family:monospace">batch</span> flag, use the <span style="font-family:monospace">mergebatch</span> preference instead of <span style="font-family:monospace">merge</span>.</p><blockquote class="quote">
<span style="font-style:italic">Please post suggestions for other useful values of the
</span><code class="verb"><span style="font-style:italic">merge</span></code><span style="font-style:italic"> preference to the </span><span style="font-style:italic"><span style="font-family:monospace">unison-users</span></span><span style="font-style:italic"> mailing list—we’d like
to give several examples here.
</span></blockquote><!--TOC subsection id="sec46" The User Interface-->
<h3 id="sec46" class="subsection"><a id="ui">The User Interface</a></h3><!--SEC END --><p>Both the textual and the graphical user interfaces are intended to be
mostly self-explanatory. Here are just a few tricks:
</p><ul class="itemize"><li class="li-itemize">
By default, when running on Unix the textual user interface will
try to put the terminal into the “raw mode” so that it reads the input a
character at a time rather than a line at a time. (This means you can
type just the single keystroke “<code class="verb">&gt;</code>” to tell Unison to
propagate a file from left to right, rather than “<code class="verb">&gt;</code> Enter.”)<p>There are some situations, though, where this will not work — for
example, when Unison is running in a shell window inside Emacs.
Setting the <code class="verb">dumbtty</code> preference will force Unison to leave the
terminal alone and process input a line at a time.
</p></li></ul><!--TOC subsection id="sec47" Interrupting a Synchronization-->
<h3 id="sec47" class="subsection"><a id="intr">Interrupting a Synchronization</a></h3><!--SEC END --><p>It is possible to interrupt an ongoing synchronization process before it
completes. Different user interfaces offer different ways of doing it.</p><p><br>
<em>Graphical Interface:</em></p><ul class="itemize"><li class="li-itemize">

In the graphical user interface the synchronization process can be interrupted
before it is finished by pressing the “Stop” button or by closing the window.
The “Stop” button causes the onging propagation to be stopped as quickly as
possible while still doing proper cleanup. The application keeps running and a
rescan can be performed or a different profile selected. Closing the window in
the middle of update propagation process will exit the application immediately
without doing proper cleanup; it is therefore not recommended unless the
“Stop” button does not react quickly enough.
</li></ul><p><br>
<em>Textual Interface:</em></p><ul class="itemize"><li class="li-itemize">

When not synchronizing continuously, the text interface terminates when
synchronization is finished normally or due to a fatal error occurring.<p>In the text interface, to interrupt synchronization before it is finished,
press “Ctrl-C” (or send signal <code class="verb">SIGINT</code> or <code class="verb">SIGTERM</code>). This will
interrupt update propagation as quickly as possible but still complete proper
cleanup. If the process does not stop even after pressing “Ctrl-C” then keep
doing it repeatedly. This will bypass cleanup procedures and terminates the
process forcibly (similar to <code class="verb">SIGKILL</code>). Doing so may leave the archives
or replicas in an inconsistent state or locked.</p><p>When synchronizing continuously (time interval repeat or with filesystem
monitoring), interrupting with “Ctrl-C” or with signal <code class="verb">SIGINT</code> or
<code class="verb">SIGTERM</code> works the same way as described above and will additionally stop
the continuous process. To stop only the continuous process and let the last
synchronization complete normally, send signal <code class="verb">SIGUSR2</code> instead.
</p></li></ul><!--TOC subsection id="sec48" Exit Code-->
<h3 id="sec48" class="subsection"><a id="exit">Exit Code</a></h3><!--SEC END --><p>When running in the textual mode, Unison returns an exit status, which
describes whether, and at which level, the synchronization was successful.
The exit status could be useful when Unison is invoked from a script.
Currently, there are four possible values for the exit status:
</p><ul class="itemize"><li class="li-itemize">
0: successful synchronization; everything is up-to-date now.
</li><li class="li-itemize">1: some files were skipped, but all file transfers were successful.
</li><li class="li-itemize">2: non-fatal failures occurred during file transfer.
</li><li class="li-itemize">3: a fatal error occurred, or the execution was interrupted.
</li></ul><p>
The graphical interface does not return any useful information through the
exit status.</p><!--TOC subsection id="sec49" Path Specification-->
<h3 id="sec49" class="subsection"><a id="pathspec">Path Specification</a></h3><!--SEC END --><p>
Several Unison preferences (e.g., <code class="verb">ignore</code>/<code class="verb">ignorenot</code>,
<code class="verb">follow</code>, <code class="verb">sortfirst</code>/<code class="verb">sortlast</code>, <code class="verb">backup</code>,
<code class="verb">merge</code>, etc.)
specify individual paths or sets of paths. These preferences share a
common syntax based on regular-expressions. Each preference
is associated with a list of path patterns; the paths specified are those
that match any one of the path pattern.</p><ul class="itemize"><li class="li-itemize">
Pattern preferences can be given on the command line,
or, more often, stored in profiles, using the same syntax as other preferences.
For example, a profile line of the form
<pre>
             ignore = <span style="font-family:monospace"><span style="font-style:italic">pattern</span></span>
</pre>
adds <span style="font-family:monospace"><span style="font-style:italic">pattern</span></span> to the list of patterns to be ignored.</li><li class="li-itemize">Each <span style="font-family:monospace"><span style="font-style:italic">pattern</span></span> can have one of three forms. The most
general form is a Posix extended regular expression introduced by the
keyword <code class="verb">Regex</code>. (The collating sequences and character classes of
full Posix regexps are not currently supported).
<pre>
                 Regex <span style="font-family:monospace"><span style="font-style:italic">regexp</span></span>
</pre>
For convenience, three other styles of pattern are also recognized:
<pre>
                 Name <span style="font-family:monospace"><span style="font-style:italic">name</span></span>
</pre>
matches any path in which the last component matches <span style="font-family:monospace"><span style="font-style:italic">name</span></span>,
<pre>
                 Path <span style="font-family:monospace"><span style="font-style:italic">path</span></span>
</pre>
matches exactly the path <span style="font-family:monospace"><span style="font-style:italic">path</span></span>, and
<pre>
                 BelowPath <span style="font-family:monospace"><span style="font-style:italic">path</span></span>
</pre>
matches the path <span style="font-family:monospace"><span style="font-style:italic">path</span></span> and any path below.
The <span style="font-family:monospace"><span style="font-style:italic">name</span></span> and <span style="font-family:monospace"><span style="font-style:italic">path</span></span> arguments of the latter forms of
patterns are <em>not</em> regular expressions. Instead,
standard “globbing” conventions can be used in <span style="font-family:monospace"><span style="font-style:italic">name</span></span> and
<span style="font-family:monospace"><span style="font-style:italic">path</span></span>:
<ul class="itemize"><li class="li-itemize">
a <code class="verb">*</code> matches any sequence of characters not including <code class="verb">/</code>
(and not beginning with <code class="verb">.</code>, when used at the beginning of a
<span style="font-family:monospace"><span style="font-style:italic">name</span></span>)
</li><li class="li-itemize">a <code class="verb">?</code> matches any single character except <code class="verb">/</code> (and leading
<code class="verb">.</code>)
</li><li class="li-itemize"><code class="verb">[xyz]</code> matches any character from the set {<span style="font-family:monospace"><span style="font-style:italic">x</span></span>,
<span style="font-family:monospace"><span style="font-style:italic">y</span></span>, <span style="font-family:monospace"><span style="font-style:italic">z</span></span> }
</li><li class="li-itemize"><code class="verb">{a,bb,ccc}</code> matches any one of <code class="verb">a</code>, <code class="verb">bb</code>, or
<code class="verb">ccc</code>. (Be careful not to put extra spaces after the commas:
these will be interpreted literally as part of the strings to be matched!)
</li></ul>
</li><li class="li-itemize">The path separator in path patterns is always the
forward-slash character “/” — even when the client or server is
running under Windows, where the normal separator character is a
backslash. This makes it possible to use the same set of path
patterns for both Unix and Windows file systems.
</li><li class="li-itemize">A path specification may be followed by the separator “<code class="verb"> -&gt; </code>” itself
followed by a string which will be associated to the matching paths:
<pre>
                 Path <span style="font-family:monospace"><span style="font-style:italic">path</span></span> -&gt; <span style="font-family:monospace"><span style="font-style:italic">associated string</span></span>
</pre>
Not all pathspec preferences use these associated strings but all pathspec
preferences are parsed identically and the strings may be ignored. Only the
last match of the separator string on the line is used as a delimiter. Thus
to allow a path specification to contain the separator string, append an
associated string to it, even if it is not used. The associated string cannot
contain the separator string.
</li></ul><p>
Some examples of path patterns appear in the <a href="#ignore">Ignoring Paths</a> section.
Associated strings are used by the preference <span style="font-family:monospace">merge</span>.</p><!--TOC subsection id="sec50" Ignoring Paths-->
<h3 id="sec50" class="subsection"><a id="ignore">Ignoring Paths</a></h3><!--SEC END --><p>Most users of Unison will find that their replicas contain lots of
files that they don’t ever want to synchronize — temporary files,
very large files, old stuff, architecture-specific binaries, etc.
They can instruct Unison to ignore these paths using patterns
introduced in the <a href="#pathspec">Path Specification</a> section.</p><p>For example, the following pattern will make Unison ignore any
path containing the name <code class="verb">CVS</code> or a name ending in <code class="verb">.cmo</code>:
</p><pre class="verbatim">             ignore = Name {CVS,*.cmo}
</pre><p>
The next pattern makes Unison ignore the path <code class="verb">a/b</code>:
</p><pre class="verbatim">             ignore = Path a/b
</pre><p>
Path patterns do <em>not</em> skip filenames beginning with <code class="verb">.</code> (as Name
patterns do). For example,
</p><pre class="verbatim">             ignore = Path */tmp
</pre><p>
will include <code class="verb">.foo/tmp</code> in the set of ignore directories, as it is a
path, not a name, that is ignored.</p><p>The following pattern makes Unison ignore any path beginning with <code class="verb">a/b</code>
and ending with a name ending by <code class="verb">.ml</code>.
</p><pre class="verbatim">             ignore = Regex a/b/.*\.ml
</pre><p>
Note that regular expression patterns are “anchored”: they must
match the whole path, not just a substring of the path.</p><p>Here are a few extra points regarding the <span style="font-family:monospace">ignore</span> preference.
</p><ul class="itemize"><li class="li-itemize">
If a directory is ignored, all its descendants will be too.</li><li class="li-itemize">The user interface provides some convenient commands for adding
new patterns to be ignored. To ignore a particular file, select it
and press “<span style="font-family:monospace">i</span>”. To ignore all files with the same extension,
select it and press “<span style="font-family:monospace">E</span>” (with the shift key). To ignore all
files with the same name, no matter what directory they appear in,
select it and press “<span style="font-family:monospace">N</span>”.
These new patterns become permanent: they
are immediately added to the current profile on disk.</li><li class="li-itemize">If you use the <code class="verb">include</code> directive to include a common
collection of preferences in several top-level preference files, you will
probably also want to set the <code class="verb">addprefsto</code> preference to the name of
this file. This will cause any new ignore patterns that you add from
inside Unison to be appended to this file, instead of whichever top-level
preference file you started Unison with.</li><li class="li-itemize">Ignore patterns can also be specified on the command line, if
you like (this is probably not very useful), using an option like
<code class="verb">-ignore 'Name temp.txt'</code>.</li><li class="li-itemize">Be careful about renaming directories containing ignored files.
Because Unison understands the rename as a delete plus a create, any ignored
files in the directory will be lost (since they are invisible to Unison and
therefore they do not get recreated in the new version of the directory).</li><li class="li-itemize">There is also an <code class="verb">ignorenot</code> preference, which specifies a set of
patterns for paths that should <em>not</em> be ignored, even if they match an
<code class="verb">ignore</code> pattern. However, the interaction of these two sets of
patterns can be a little tricky. Here is exactly how it works:
<ul class="itemize"><li class="li-itemize">
Unison starts detecting updates from the root of the
replicas—i.e., from the empty path. If the empty path matches an
<code class="verb">ignore</code> pattern and does not match an <code class="verb">ignorenot</code> pattern, then
the whole replica will be ignored. (For this reason, it is not a good
idea to include <code class="verb">Name *</code> as an <code class="verb">ignore</code> pattern. If you want to
ignore everything except a certain set of files, use <code class="verb">Name ?*</code>.)
</li><li class="li-itemize">If the root is a directory, Unison continues looking for updates in
all the immediate children of the root. Again, if the name of some child matches an
<code class="verb">ignore</code> pattern and does not match an <code class="verb">ignorenot</code> pattern, then
this whole path <em>including everything below it</em> will be ignored.
</li><li class="li-itemize">If any of the non-ignored children are directories, then the process
continues recursively.
</li></ul>
</li></ul><!--TOC subsection id="sec51" Symbolic Links-->
<h3 id="sec51" class="subsection"><a id="symlinks">Symbolic Links</a></h3><!--SEC END --><p>Ordinarily, Unison treats symbolic links in Unix replicas as
“opaque”: it considers the contents of the link to be just the
string specifying where the link points, and it will propagate changes in
this string to the other replica.</p><p>It is sometimes useful to treat a symbolic link “transparently,”
acting as though whatever it points to were physically <em>in</em> the
replica at the point where the symbolic link appears. To tell Unison
to treat a link in this manner, add a line of the form
</p><pre>
             follow = <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span>
</pre><p>
to the profile, where <span style="font-family:monospace"><span style="font-style:italic">pathspec</span></span> is a path pattern as described in
the <a href="#pathspec">Path Specification</a> section.</p><p>Not all Windows versions and file systems support symbolic links; Unison will
refuse to propagate an opaque symbolic link from Unix to Windows and flag the
path as erroneous if the support or privileges are lacking on the Windows side.
When a Unix replica is to be synchronized with such Windows system, all symbolic
links should match either an <code class="verb">ignore</code> pattern or a <code class="verb">follow</code> pattern.</p><p>You may need to acquire extra privileges to create symbolic links under
Windows. By default, this is only allowed for administrators. Unison may not
be able to automatically detect support for symbolic links under Windows. In
that case, set the preference <span style="font-family:monospace">links</span> to <span style="font-family:monospace">true</span> explicitly.</p><!--TOC subsection id="sec52" Permissions-->
<h3 id="sec52" class="subsection"><a id="perms">Permissions</a></h3><!--SEC END --><p>Synchronizing the permission bits of files is slightly tricky when two
different filesystems are involved (e.g., when synchronizing a Windows
client and a Unix server). In detail, here’s how it works:
</p><ul class="itemize"><li class="li-itemize">
When the permission bits of an existing file or directory are
changed, the values of those bits that make sense on <em>both</em>
operating systems will be propagated to the other replica. The other
bits will not be changed.
</li><li class="li-itemize">When a newly created file is propagated to a remote replica, the
permission bits that make sense in both operating systems are also
propagated. The values of the other bits are set to default values
(they are taken from the current umask, if the receiving host is a
Unix system).
</li><li class="li-itemize">For security reasons, the Unix <code class="verb">setuid</code> and <code class="verb">setgid</code>
bits are not propagated.
</li><li class="li-itemize">The Unix owner and group ids can be propagated (see <code class="verb">owner</code>
and <code class="verb">group</code> preferences) by mapping names or by numeric ids (see
<code class="verb">numericids</code> preference).
</li></ul><!--TOC subsection id="sec53" Access Control Lists - ACLs-->
<h3 id="sec53" class="subsection"><a id="acls">Access Control Lists - ACLs</a></h3><!--SEC END --><p>Unison allows synchronizing access control lists (ACLs) on platforms
and filesystems that support them. In general, synchronization makes
sense only in case both replicas support the same type of ACLs and
recognize same users and groups. In some cases you may be able to
go beyond that and synchronize ACLs to a replica that couldn’t fully
use them—this may be be useful for the purpose of preserving ACLs.</p><p>If one of the replicas does not support any type of ACLs then
Unison will not attempt ACL synchronization. If the other replica
does support ACLs then those will remain intact.</p><p>If both replicas support ACLs of any supported type then you can
request Unison to try ACL synchronization (<code class="verb">acl</code> preference).
Success of synchronization depends on permissions of the owner and
group of Unison process (Unison must have permissions to set ACL)
and the compatibility of ACL types on both replicas.</p><p>An ACL is propagated as a single unit, with all ACEs. There is no
merging of ACEs from the replicas.</p><p><em>Caveat</em>: ACE inheritance may in certain scenarios cause synchronization
inconsistencies. In Windows, only explicit ACEs are synchronized; inherited
ACEs are not actively synchronized, but Windows will propagate ACEs from parent
directories (unless inheritance is explicitly prevented on a file or a
directory—this prevention is also synchronized). Due to inheritance, the
ultimately effective ACL may be different, or provide different access, even
after synchronization.</p><p>Unison currently supports the following platforms and ACL types:
</p><ul class="itemize"><li class="li-itemize">
Windows (Windows XP SP2 and later)
<ul class="itemize"><li class="li-itemize">
NTFS ACL (discrete ACL (DACL) only)
</li></ul>
</li><li class="li-itemize">Solaris, OpenSolaris and illumos-based OS (OpenIndiana, SmartOS,
OmniOS, etc.)
<ul class="itemize"><li class="li-itemize">
NFSv4 ACL (ZFS ACL)
</li><li class="li-itemize">POSIX-draft ACL
</li><li class="li-itemize">Some NFSv4 ACL (ZFS ACL) cross-synchronization with
POSIX-draft ACL
</li><li class="li-itemize">Full cross-synchronization with other platforms that support
NFSv4 ACLs; limited cross-synchronization with POSIX-draft ACLs
</li></ul>
</li><li class="li-itemize">FreeBSD, NetBSD
<ul class="itemize"><li class="li-itemize">
NFSv4 ACL (ZFS ACL)
</li><li class="li-itemize">Limited POSIX-draft ACL (access ACL only; not default ACL)
</li><li class="li-itemize">Full cross-synchronization with other platforms that support
NFSv4 ACLs
</li></ul>
</li><li class="li-itemize">Darwin (macOS)
<ul class="itemize"><li class="li-itemize">
Extended ACL
</li></ul>
</li></ul><p>
Not all filesystems on the listed platforms support all ACL types
(or any ACLs at all).</p><p>Synchronizing POSIX ACLs on Linux is not supported directly. However, it is
possible to synchronize these ACLs with another Linux system by synchronizing
extended attributes (xattrs) instead, because POSIX ACLs are stored as xattrs
by Linux. This is disabled by default (see the <a href="#xattrs">Extended
Attributes - xattrs</a> section). A simple way to enable syncing POSIX ACLs on Linux is
to enable the preference <code class="verb">xattrs</code> and add a preference
<code class="verb">xattrignorenot</code> with a value <span style="font-family:monospace">Path !system.posix_acl_*</span>. The
<code class="verb">*</code> will be expanded to include both <code class="verb">posix_acl_access</code> and
<code class="verb">posix_acl_default</code> attributes – if you only want to sync either one,
just remove the <code class="verb">*</code> and type out the attribute name in full. If you want
to prevent other xattrs from being synced then add an <code class="verb">xattrignore</code> with a
value <span style="font-family:monospace">Path *</span> (value <span style="font-family:monospace">Regex .*</span> will also work).</p><!--TOC subsection id="sec54" Extended Attributes - xattrs-->
<h3 id="sec54" class="subsection"><a id="xattrs">Extended Attributes - xattrs</a></h3><!--SEC END --><p>Unison allows synchronizing extended attributes on platforms and
filesystems that support them. System attributes are not synchronized.
What exactly is considered a system attribute is platform-dependent.
Synchronization is possible cross-platform, but see caveats below.</p><p>If one of the replicas does not support extended attributes then
Unison will not attempt attribute synchronization. If the other
replica does support extended attributes then those will remain intact.</p><p>If both replicas support extended attributes then you can request
Unison to try attribute synchronization (<code class="verb">xattrs</code> preference).
Extended attributes from both replicas will not be merged, all extended
attributes are propagated as a set from one replica to another.</p><p>Unison currently supports extended attributes on the following platforms:
</p><ul class="itemize"><li class="li-itemize">
<em>Linux</em>
Attributes in user, trusted and security namespaces. Synchronization of
the latter two namespaces depends on <code class="verb">unison</code> process privileges
and is disabled by default. To sync one or more attributes in the security
namespace, for example, you can set the preference
<code class="verb">xattrignorenot</code> to <code class="verb">Path !security.*</code> (for all) or to
<code class="verb">Path !security.selinux</code> (for one specific attribute).
Attributes in system namespace are not synchronized, with the exception of
<code class="verb">system.posix_acl_default</code> and <code class="verb">system.posix_acl_access</code> (also
disabled by default).
</li><li class="li-itemize"><em>Solaris, OpenSolaris and illumos-based OS (OpenIndiana, SmartOS,
OmniOS, etc.)</em>
</li><li class="li-itemize"><em>FreeBSD, NetBSD</em>
Attributes in user namespace.
</li><li class="li-itemize"><em>Darwin (macOS)</em>
</li></ul><p>
Not all filesystems on the listed platforms may support extended attributes.</p><p><span style="font-style:italic">Caveats:</span>
</p><ul class="itemize"><li class="li-itemize">
Some platforms and file systems support very large extended attribute
values. Unison synchronizes only up to 16 MB of each attribute value.
</li><li class="li-itemize">Attributes are synchronized as simple name-value pairs. More complex
extended attribute concepts supported by some platforms are not synchronized.
</li><li class="li-itemize">On Linux, attribute names always have a fully qualified form
(<span style="font-family:monospace">namespace.attribute</span>). Other platforms do not have the same constraint.
The consequence of this is that Unison will sync the attribute names on Linux
as follows: an <code class="verb">!</code> is prepended to the namespace name, except for the
<code class="verb">user</code> namespace; the <code class="verb">user.</code> prefix is stripped from attribute names
instead. This allows syncing extended attributes from Linux to other platforms.
These transformations are reversed when syncing <em>to</em> Linux, resulting in
correct fully qualified attribute names.
The <code class="verb">xattrignore</code> and <code class="verb">xattrignorenot</code> preferences work on the
transformed attribute names. This means that any patterns for the user
namespace must be specified without the <code class="verb">user.</code> prefix and any patterns
intended for other namespaces must begin with an <code class="verb">!</code>.
</li></ul><p>The <code class="verb">xattrignore</code> preference can be used to filter the names of extended
attributes that will be synchronized. The most useful ignore patterns can
be constructed with the <code class="verb">Path</code> form (where shell wildcards <code class="verb">*</code> and
<code class="verb">?</code> are supported) and with the <code class="verb">Regex</code> form. The
<code class="verb">xattrignorenot</code> preference can be used to override <code class="verb">xattrignore</code>.</p><p>Disabling the security and trusted namespaces on Linux is achieved by setting
a default <code class="verb">xattrignore</code> pattern of
<span style="font-family:monospace">Regex !(security|trusted)[.].*</span>.
Disabling the syncing of attributes used to store POSIX ACL on Linux is
achieved by setting a default <code class="verb">xattrignore</code> pattern of
<span style="font-family:monospace">Path !system.posix_acl_*</span>.</p><!--TOC subsection id="sec55" Cross-Platform Synchronization-->
<h3 id="sec55" class="subsection"><a id="crossplatform">Cross-Platform Synchronization</a></h3><!--SEC END --><p>If you use Unison to synchronize files between Windows and Unix
systems, there are a few special issues to be aware of.</p><p><span style="font-weight:bold">Case conflicts.</span> In Unix, filenames are case sensitive:
<span style="font-family:monospace">foo</span> and <span style="font-family:monospace">FOO</span> can refer to different files. In
Windows, on the other hand, filenames are not case sensitive:
<span style="font-family:monospace">foo</span> and <span style="font-family:monospace">FOO</span> can only refer to the same file. This
means that a Unix <span style="font-family:monospace">foo</span> and <span style="font-family:monospace">FOO</span> cannot be synchronized
onto a Windows system — Windows won’t allow two different files to
have the “same” name. Unison detects this situation for you, and
reports that it cannot synchronize the files.</p><p>You can deal with a case conflict in a couple of ways. If you need to
have both files on the Windows system, your only choice is to rename
one of the Unix files to avoid the case conflict, and re-synchronize.
If you don’t need the files on the Windows system, you can simply
disregard Unison’s warning message, and go ahead with the
synchronization; Unison won’t touch those files. If you don’t want to
see the warning on each synchronization, you can tell Unison to ignore
the files (see the <a href="#ignore">Ignoring Paths</a> section).</p><p><span style="font-weight:bold">Illegal filenames.</span> Unix allows some filenames that are
illegal in Windows. For example, colons (‘:’) are not allowed in
Windows filenames, but they are legal in Unix filenames. This means
that a Unix file <span style="font-family:monospace">foo:bar</span> can’t be synchronized to a Windows
system. As with case conflicts, Unison detects this situation for
you, and you have the same options: you can either rename the Unix
file and re-synchronize, or you can ignore it.</p><!--TOC subsection id="sec56" Slow Links-->
<h3 id="sec56" class="subsection"><a id="speed">Slow Links</a></h3><!--SEC END --><p>Unison is built to run well even over relatively slow links such as
modems and DSL connections.</p><p>Unison uses the “rsync protocol” designed by Andrew Tridgell and Paul
Mackerras to greatly speed up transfers of large files in which only
small changes have been made. More information about the rsync protocol
can be found at the rsync web site (<a href="http://samba.anu.edu.au/rsync/"><span style="font-family:monospace">http://samba.anu.edu.au/rsync/</span></a>).</p><p>If you are using Unison with <span style="font-family:monospace">ssh</span>, you may get some speed
improvement by enabling <span style="font-family:monospace">ssh</span>’s compression feature. Do this by
adding the option “<span style="font-family:monospace">-sshargs -C</span>” to the command line or “<span style="font-family:monospace">sshargs = -C</span>” to your profile.</p><!--TOC subsection id="sec57" Making Unison Faster on Large Files-->
<h3 id="sec57" class="subsection"><a id="speeding">Making Unison Faster on Large Files</a></h3><!--SEC END --><p>Unison’s built-in implementation of the rsync algorithm makes transferring
updates to existing files pretty fast. However, for whole-file copies of
newly created files, the built-in transfer method is not highly optimized.
Also, if Unison is interrupted in the middle of transferring a large file,
it will attempt to retransfer the whole thing on the next run.</p><p>These shortcomings can be addressed with a little extra work by telling
Unison to use an external file copying utility for whole-file transfers.
The recommended one is the standalone <span style="font-family:monospace">rsync</span> tool, which is available
by default on most Unix systems and can easily be installed on Windows
systems using Cygwin.</p><p>If you have <span style="font-family:monospace">rsync</span> installed on both hosts, you can make Unison use it
simply by setting the <span style="font-family:monospace">copythreshold</span> flag to something non-negative.
If you set it to 0, Unison will use the external copy utility for <em>all</em>
whole-file transfers. (This is probably slower than letting Unison copy
small files by itself, but can be useful for testing.) If you set it to a
larger value, Unison will use the external utility for all files larger than
this size (which is given in kilobytes, so setting it to 1000 will cause the
external tool to be used for all transfers larger than a megabyte).</p><p>If you want to use a different external copy utility, set both the <span style="font-family:monospace">copyprog</span> and <span style="font-family:monospace">copyprogrest</span> preferences—the former is used for
the first transfer of a file, while the latter is used when Unison sees a
partially transferred temp file on the receiving host. Be careful here:
Your external tool needs to be instructed to copy files in place (otherwise
if the transfer is interrupted Unison will not notice that some of the data
has already been transferred, the next time it tries). The default values
are:
</p><pre class="verbatim">   copyprog      =   rsync --inplace --compress
   copyprogrest  =   rsync --partial --inplace --compress
</pre><p>If a <em>directory</em> transfer is interrupted, the next run of Unison will
automatically skip any files that were completely transferred before the
interruption. (This behavior is always on: it does not depend on the
setting of the <span style="font-family:monospace">copythreshold</span> preference.) Note, though, that the new
directory will not appear in the destination filesystem until everything has
been transferred—partially transferred directories are kept in a temporary
location (with names like <span style="font-family:monospace">.unison.DIRNAME....</span>) until the transfer is
complete.</p><!--TOC subsection id="sec58" Fast Update Detection-->
<h3 id="sec58" class="subsection"><a id="fastcheck">Fast Update Detection</a></h3><!--SEC END --><p>If your replicas are large and at least one of them is on a Windows
system, you may find that Unison’s default method for detecting changes
(which involves scanning the full contents of every file on every
sync—the only completely safe way to do it under Windows) is too slow.
Unison provides a preference <span style="font-family:monospace">fastcheck</span> that, when set to
<code class="verb">true</code>, causes it to use file creation times as ’pseudo inode
numbers’ when scanning replicas for updates, instead of reading the full
contents of every file.</p><p>When <code class="verb">fastcheck</code> is set to <code class="verb">no</code>,
Unison will perform slow checking—re-scanning the contents of each file
on each synchronization—on all replicas. When <code class="verb">fastcheck</code> is set
to <code class="verb">default</code> (which, naturally, is the default), Unison will use
fast checks on Unix replicas and slow checks on Windows replicas.</p><p>This strategy may cause Unison to miss propagating an update if the
modification time and length of the file are both unchanged
by the update.
However, Unison will never <em>overwrite</em> such an update with a change
from the other replica, since it always does a safe check for updates
just before propagating a change. Thus, it is reasonable to use this
switch most of the time and occasionally run Unison once with <span style="font-family:monospace">fastcheck</span> set to <code class="verb">no</code>, if you are worried that Unison may have
overlooked an update.</p><p>Fastcheck is (always) automatically disabled for files with extension
<code class="verb">.xls</code> or <code class="verb">.mpp</code>, to prevent Unison from being confused by the
habits of certain programs (Excel, in particular) of updating files without
changing their modification times.</p><!--TOC subsection id="sec59" Mount Points and Removable Media-->
<h3 id="sec59" class="subsection"><a id="mountpoints">Mount Points and Removable Media</a></h3><!--SEC END --><p>Using Unison removable media such as USB drives can be dangerous unless you
are careful. If you synchronize a directory that is stored on removable
media when the media is not present, it will look to Unison as though the
whole directory has been deleted, and it will proceed to delete the
directory from the other replica—probably not what you want!</p><p>To prevent accidents, Unison provides a preference called
<code class="verb">mountpoint</code>. Including a line like
</p><pre class="verbatim">             mountpoint = foo
</pre><p>
in your preference file will cause Unison to check, after it finishes
detecting updates, that something actually exists at the path
<code class="verb">foo</code> on both replicas; if it does not, the Unison run will
abort.</p><p></div></p><!--CUT END -->
<!--HTMLFOOT-->
<!--ENDHTML-->
<!--FOOTER-->
<hr class="horizontal-rule" style="height:2px"><blockquote class="quote"><em>This document was translated from L<sup>A</sup>T<sub>E</sub>X by
</em><a href="http://hevea.inria.fr/index.html"><em>H</em><em><span style="font-size:small"><sup>E</sup></span></em><em>V</em><em><span style="font-size:small"><sup>E</sup></span></em><em>A</em></a><em>.</em></blockquote></body>
</html>
